<template name="markdownInfo">

    <div id="page-wrapper">
        <!-- Main -->
        <div id="main" class="wrapper style1">
            <div class="container">
                <header class="major">
                    <h2>{{title}}</h2>
                    <p>Markdown cheatsheet and playground.</p>
                </header>

                <section>
                    <div style="position:relative">

                        <div class="container" style="height:377px;overflow:auto;border-style:solid;border-width:thick;">
                            <div class="article js-hide-during-search">

                                <div class="article-body content-body wikistyle markdown-format">

                                    <h3>
                                        <a id="headings" class="anchor" href="#headings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Headings</h3>

                                    <p>To create a heading, add one to six <code>#</code> symbols before your heading text. The number of <code>#</code> you use will determine the size of the heading.</p>

                                    <pre><code># The largest heading<br>## The second largest heading<br>###### The smallest heading</code></pre>

                                    <h3>
                                        <a id="styling-text" class="anchor" href="#styling-text" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Styling text</h3>

                                    <p>You can indicate emphasis with bold, italic, or strikethrough text.</p>

                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Style</th>
                                                <th>Syntax</th>
                                                <th>Keyboard shortcut</th>
                                                <th>Example</th>
                                                <th>Output</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Bold</td>
                                                <td>
                                                    <code>** **</code> or <code>__ __</code>
                                                </td>
                                                <td>command/control + b</td>
                                                <td><code>**This is bold text**</code></td>
                                                <td><strong>This is bold text</strong></td>
                                            </tr>
                                            <tr>
                                                <td>Italic</td>
                                                <td>
                                                    <code>* *</code> or <code>_ _</code>
                                                </td>
                                                <td>command/control + i</td>
                                                <td><code>*This text is italicized*</code></td>
                                                <td><em>This text is italicized</em></td>
                                            </tr>
                                            <tr>
                                                <td>Strikethrough</td>
                                                <td><code>~~ ~~</code></td>
                                                <td></td>
                                                <td><code>~~This was mistaken text~~</code></td>
                                                <td><del>This was mistaken text</del></td>
                                            </tr>
                                            <tr>
                                                <td>Bold and italic</td>
                                                <td>
                                                    <code>** **</code> and <code>_ _</code>
                                                </td>
                                                <td></td>
                                                <td><code>**This text is _extremely_ important**</code></td>
                                                <td><strong>This text is <em>extremely</em> important</strong></td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <h3>
                                        <a id="quoting-text" class="anchor" href="#quoting-text" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Quoting text</h3>

                                    <p>You can quote text with a <code>&gt;</code>.</p>

                                    <pre><code>In the words of Abraham Lincoln:<br>&gt; Pardon my French</code></pre>


                                    <div class="alert tip">

                                        <p><strong>Tip:</strong> When viewing an issue or pull request, you can automatically quote text in a reply by highlighting the text, then typing <code>r</code>. For more information, see "<a href="/articles/using-keyboard-shortcuts/">Using keyboard shortcuts</a>."</p>

                                    </div>

                                    <h3>
                                        <a id="quoting-code" class="anchor" href="#quoting-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Alternative quote</h3>

                                    <p>You can call out statements within a sentence with single backticks. The text within the backticks will not be formatted.</p>

                                    <p><code>Use `this` to list all new or modified files that haven't yet been committed.</code></p>


                                    <h3>
                                        <a id="links" class="anchor" href="#links" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Links</h3>

                                    <p>You can create an inline link by wrapping link text in brackets <code>[ ]</code>, and then wrapping the URL in parentheses <code>( )</code>. You can also use the keyboard shortcut <code>command + k</code> to create a link.</p>

                                    <p><code>Check out [this site](https://opensourcehollywood.org/).</code></p>


                                    <h3>
                                        <a id="lists" class="anchor" href="#lists" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lists</h3>

                                    <p>You can make a list by preceding one or more lines of text with <code>-</code> or <code>*</code>.</p>

                                    <pre><code>- George Washington<br>- John Adams<br>- Thomas Jefferson</code></pre>

                                    <p>To order your list, precede each line with a number.</p>

                                    <pre><code>1. James Madison<br>2. James Monroe<br>3. John Quincy Adams</code></pre>

                                    <p><strong>Nested Lists</strong></p>

                                    <p>You can also create nested lists.</p>

                                    <p>If you're writing in the web editor on GitHub or in a text editor that uses a monospaced font, like <a href="https://atom.io/">Atom</a>, you can create a nested list by aligning your list visually with the list above it.</p>

                                    <p>For example, you can type space characters until the list marker character (<code>-</code> or <code>*</code>) lies directly below the first character of the text in the list item above it.</p>

                                    <pre><code>1. First list item in first line.<br>  - First nested list item<br>    - Second nested list item</code></pre>

                                    <p>If you're writing a comment on an issue, you can create a nested list by counting the space characters before the content of the list above your nested list. Then in your nested list, you must indent by the number of space characters before the content of the list above your nested list.</p>

                                 <h3>
                                        <a id="using-emoji" class="anchor" href="#using-emoji" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using emoji</h3>

                                    <p>You can add emoji to your writing by typing <code>:EMOJICODE:</code>.</p>

                                    <p><code>@octocat :+1: This PR looks great - it's ready to merge! :shipit:</code></p>

                                    <p>Typing <code>:</code> will bring up a list of suggested emoji. The list will filter as you type, so once you find the emoji you're looking for, press <strong>Tab</strong> or <strong>Enter</strong> to complete the highlighted result.</p>

                                    <p>For a full list of available emoji and codes, check out <a href="http://emoji-cheat-sheet.com">emoji-cheat-sheet.com</a>.</p>

                                    <h3>
                                        <a id="paragraphs-and-line-breaks" class="anchor" href="#paragraphs-and-line-breaks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Paragraphs and line breaks</h3>

                                    <p>You can create a new paragraph by leaving a blank line between lines of text.</p>

                                    <h3>
                                        <a id="ignoring-markdown-formatting" class="anchor" href="#ignoring-markdown-formatting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ignoring Markdown formatting</h3>

                                    <p>You can ignore (or escape) Markdown formatting by using <code>\</code> before the Markdown character.</p>

                                    <p><code>Let's rename \*our-new-project\* to \*our-old-project\*.</code></p>

                                    <h3>
                                        <a id="further-reading" class="anchor" href="#further-reading" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Further reading</h3>

                                    <ul>
                                        <li>"<a href="/articles/about-writing-and-formatting-on-github">About writing and formatting on GitHub</a>"</li>
                                        <li>"<a href="/articles/working-with-advanced-formatting">Working with advanced formatting</a>"</li>
                                        <li>"<a href="https://guides.github.com/features/mastering-markdown/">Mastering Markdown</a>"</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="container" style="height:233;border-color: white;border-width: thick;border-style: dashed;">

                            <h2 style="position:relative;top:5px;left:5px">Playground</h2>
                            <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
                            <script type="text/javascript">
                                //
                                // showdown.js -- A javascript port of Markdown.
                                //
                                // Copyright (c) 2007 John Fraser.
                                //
                                // Original Markdown Copyright (c) 2004-2005 John Gruber
                                //   <http://daringfireball.net/projects/markdown/>
                                //
                                // Redistributable under a BSD-style open source license.
                                // See license.txt for more information.
                                //
                                // The full source distribution is at:
                                //
                                //        A A L
                                //        T C A
                                //        T K B
                                //
                                //   <http://www.attacklab.net/>
                                //

                                //
                                // Wherever possible, Showdown is a straight, line-by-line port
                                // of the Perl version of Markdown.
                                //
                                // This is not a normal parser design; it's basically just a
                                // series of string substitutions.  It's hard to read and
                                // maintain this way,  but keeping Showdown close to the original
                                // design makes it easier to port new features.
                                //
                                // More importantly, Showdown behaves like markdown.pl in most
                                // edge cases.  So web applications can do client-side preview
                                // in Javascript, and then build identical HTML on the server.
                                //
                                // This port needs the new RegExp functionality of ECMA 262,
                                // 3rd Edition (i.e. Javascript 1.5).  Most modern web browsers
                                // should do fine.  Even with the new regular expression features,
                                // We do a lot of work to emulate Perl's regex functionality.
                                // The tricky changes in this file mostly have the "attacklab:"
                                // label.  Major or self-explanatory changes don't.
                                //
                                // Smart diff tools like Araxis Merge will be able to match up
                                // this file with markdown.pl in a useful way.  A little tweaking
                                // helps: in a copy of markdown.pl, replace "#" with "//" and
                                // replace "$text" with "text".  Be sure to ignore whitespace
                                // and line endings.
                                //


                                //
                                // Showdown usage:
                                //
                                //   var text = "Markdown *rocks*.";
                                //
                                //   var converter = new Showdown.converter();
                                //   var html = converter.makeHtml(text);
                                //
                                //   alert(html);
                                //
                                // Note: move the sample code to the bottom of this
                                // file before uncommenting it.
                                //


                                //
                                // Showdown namespace
                                //
                                var Showdown = {};

                                //
                                // converter
                                //
                                // Wraps all "globals" so that the only thing
                                // exposed is makeHtml().
                                //
                                Showdown.converter = function() {

                                    //
                                    // Globals:
                                    //

                                    // Global hashes, used by various utility routines
                                    var g_urls;
                                    var g_titles;
                                    var g_html_blocks;

                                    // Used to track when we're inside an ordered or unordered list
                                    // (see _ProcessListItems() for details):
                                    var g_list_level = 0;


                                    this.makeHtml = function(text) {
                                        //
                                        // Main function. The order in which other subs are called here is
                                        // essential. Link and image substitutions need to happen before
                                        // _EscapeSpecialCharsWithinTagAttributes(), so that any *'s or _'s in the <a>
                                        // and <img> tags get encoded.
                                        //

                                        // Clear the global hashes. If we don't clear these, you get conflicts
                                        // from other articles when generating a page which contains more than
                                        // one article (e.g. an index page that shows the N most recent
                                        // articles):
                                        g_urls = new Array();
                                        g_titles = new Array();
                                        g_html_blocks = new Array();

                                        // attacklab: Replace ~ with ~T
                                        // This lets us use tilde as an escape char to avoid md5 hashes
                                        // The choice of character is arbitray; anything that isn't
                                        // magic in Markdown will work.
                                        text = text.replace(/~/g, "~T");

                                        // attacklab: Replace $ with ~D
                                        // RegExp interprets $ as a special character
                                        // when it's in a replacement string
                                        text = text.replace(/\$/g, "~D");

                                        // Standardize line endings
                                        text = text.replace(/\r\n/g, "\n"); // DOS to Unix
                                        text = text.replace(/\r/g, "\n"); // Mac to Unix

                                        // Make sure text begins and ends with a couple of newlines:
                                        text = "\n\n" + text + "\n\n";

                                        // Convert all tabs to spaces.
                                        text = _Detab(text);

                                        // Strip any lines consisting only of spaces and tabs.
                                        // This makes subsequent regexen easier to write, because we can
                                        // match consecutive blank lines with /\n+/ instead of something
                                        // contorted like /[ \t]*\n+/ .
                                        text = text.replace(/^[ \t]+$/mg, "");

                                        // Turn block-level HTML blocks into hash entries
                                        text = _HashHTMLBlocks(text);

                                        // Strip link definitions, store in hashes.
                                        text = _StripLinkDefinitions(text);

                                        text = _RunBlockGamut(text);

                                        text = _UnescapeSpecialChars(text);

                                        // attacklab: Restore dollar signs
                                        text = text.replace(/~D/g, "$$");

                                        // attacklab: Restore tildes
                                        text = text.replace(/~T/g, "~");

                                        return text;
                                    }


                                    var _StripLinkDefinitions = function(text) {
                                        //
                                        // Strips link definitions from text, stores the URLs and titles in
                                        // hash references.
                                        //

                                        // Link defs are in the form: ^[id]: url "optional title"

                                        /*
                                          var text = text.replace(/
                                              ^[ ]{0,3}\[(.+)\]:  // id = $1  attacklab: g_tab_width - 1
                                                [ \t]*
                                                \n?       // maybe *one* newline
                                                [ \t]*
                                              <?(\S+?)>?      // url = $2
                                                [ \t]*
                                                \n?       // maybe one newline
                                                [ \t]*
                                              (?:
                                                (\n*)       // any lines skipped = $3 attacklab: lookbehind removed
                                                ["(]
                                                (.+?)       // title = $4
                                                [")]
                                                [ \t]*
                                              )?          // title is optional
                                              (?:\n+|$)
                                              /gm,
                                              function(){...});
                                        */
                                        var text = text.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,
                                            function(wholeMatch, m1, m2, m3, m4) {
                                                m1 = m1.toLowerCase();
                                                g_urls[m1] = _EncodeAmpsAndAngles(m2); // Link IDs are case-insensitive
                                                if (m3) {
                                                    // Oops, found blank lines, so it's not a title.
                                                    // Put back the parenthetical statement we stole.
                                                    return m3 + m4;
                                                } else if (m4) {
                                                    g_titles[m1] = m4.replace(/"/g, "&quot;");
                                                }

                                                // Completely remove the definition from the text
                                                return "";
                                            }
                                        );

                                        return text;
                                    }


                                    var _HashHTMLBlocks = function(text) {
                                        // attacklab: Double up blank lines to reduce lookaround
                                        text = text.replace(/\n/g, "\n\n");

                                        // Hashify HTML blocks:
                                        // We only want to do this for block-level HTML tags, such as headers,
                                        // lists, and tables. That's because we still want to wrap <p>s around
                                        // "paragraphs" that are wrapped in non-block-level tags, such as anchors,
                                        // phrase emphasis, and spans. The list of tags we're looking for is
                                        // hard-coded:
                                        var block_tags_a = "p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del"
                                        var block_tags_b = "p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math"

                                        // First, look for nested blocks, e.g.:
                                        //   <div>
                                        //     <div>
                                        //     tags for inner block must be indented.
                                        //     </div>
                                        //   </div>
                                        //
                                        // The outermost tags must start at the left margin for this to match, and
                                        // the inner nested divs must be indented.
                                        // We need to do this before the next, more liberal match, because the next
                                        // match will start at the first `<div>` and stop at the first `</div>`.

                                        // attacklab: This regex can be expensive when it fails.
                                        /*
                                          var text = text.replace(/
                                          (           // save in $1
                                            ^         // start of line  (with /m)
                                            <($block_tags_a)  // start tag = $2
                                            \b          // word break
                                                      // attacklab: hack around khtml/pcre bug...
                                            [^\r]*?\n     // any number of lines, minimally matching
                                            </\2>       // the matching end tag
                                            [ \t]*        // trailing spaces/tabs
                                            (?=\n+)       // followed by a newline
                                          )           // attacklab: there are sentinel newlines at end of document
                                          /gm,function(){...}};
                                        */
                                        text = text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm, hashElement);

                                        //
                                        // Now match more liberally, simply from `\n<tag>` to `</tag>\n`
                                        //

                                        /*
                                          var text = text.replace(/
                                          (           // save in $1
                                            ^         // start of line  (with /m)
                                            <($block_tags_b)  // start tag = $2
                                            \b          // word break
                                                      // attacklab: hack around khtml/pcre bug...
                                            [^\r]*?       // any number of lines, minimally matching
                                            .*</\2>       // the matching end tag
                                            [ \t]*        // trailing spaces/tabs
                                            (?=\n+)       // followed by a newline
                                          )           // attacklab: there are sentinel newlines at end of document
                                          /gm,function(){...}};
                                        */
                                        text = text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm, hashElement);

                                        // Special case just for <hr />. It was easier to make a special case than
                                        // to make the other regex more complicated.

                                        /*
                                          text = text.replace(/
                                          (           // save in $1
                                            \n\n        // Starting after a blank line
                                            [ ]{0,3}
                                            (<(hr)        // start tag = $2
                                            \b          // word break
                                            ([^<>])*?     //
                                            \/?>)       // the matching end tag
                                            [ \t]*
                                            (?=\n{2,})      // followed by a blank line
                                          )
                                          /g,hashElement);
                                        */
                                        text = text.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g, hashElement);

                                        // Special case for standalone HTML comments:

                                        /*
                                          text = text.replace(/
                                          (           // save in $1
                                            \n\n        // Starting after a blank line
                                            [ ]{0,3}      // attacklab: g_tab_width - 1
                                            <!
                                            (--[^\r]*?--\s*)+
                                            >
                                            [ \t]*
                                            (?=\n{2,})      // followed by a blank line
                                          )
                                          /g,hashElement);
                                        */
                                        text = text.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g, hashElement);

                                        // PHP and ASP-style processor instructions (<?...?> and <%...%>)

                                        /*
                                          text = text.replace(/
                                          (?:
                                            \n\n        // Starting after a blank line
                                          )
                                          (           // save in $1
                                            [ ]{0,3}      // attacklab: g_tab_width - 1
                                            (?:
                                              <([?%])     // $2
                                              [^\r]*?
                                              \2>
                                            )
                                            [ \t]*
                                            (?=\n{2,})      // followed by a blank line
                                          )
                                          /g,hashElement);
                                        */
                                        text = text.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g, hashElement);

                                        // attacklab: Undo double lines (see comment at top of this function)
                                        text = text.replace(/\n\n/g, "\n");
                                        return text;
                                    }

                                    var hashElement = function(wholeMatch, m1) {
                                        var blockText = m1;

                                        // Undo double lines
                                        blockText = blockText.replace(/\n\n/g, "\n");
                                        blockText = blockText.replace(/^\n/, "");

                                        // strip trailing blank lines
                                        blockText = blockText.replace(/\n+$/g, "");

                                        // Replace the element text with a marker ("~KxK" where x is its key)
                                        blockText = "\n\n~K" + (g_html_blocks.push(blockText) - 1) + "K\n\n";

                                        return blockText;
                                    };

                                    var _RunBlockGamut = function(text) {
                                        //
                                        // These are all the transformations that form block-level
                                        // tags like paragraphs, headers, and list items.
                                        //
                                        text = _DoHeaders(text);

                                        // Do Horizontal Rules:
                                        var key = hashBlock("<hr />");
                                        text = text.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm, key);
                                        text = text.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm, key);
                                        text = text.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm, key);

                                        text = _DoLists(text);
                                        text = _DoCodeBlocks(text);
                                        text = _DoBlockQuotes(text);

                                        // We already ran _HashHTMLBlocks() before, in Markdown(), but that
                                        // was to escape raw HTML in the original Markdown source. This time,
                                        // we're escaping the markup we've just created, so that we don't wrap
                                        // <p> tags around block-level tags.
                                        text = _HashHTMLBlocks(text);
                                        text = _FormParagraphs(text);

                                        return text;
                                    }


                                    var _RunSpanGamut = function(text) {
                                        //
                                        // These are all the transformations that occur *within* block-level
                                        // tags like paragraphs, headers, and list items.
                                        //

                                        text = _DoCodeSpans(text);
                                        text = _EscapeSpecialCharsWithinTagAttributes(text);
                                        text = _EncodeBackslashEscapes(text);

                                        // Process anchor and image tags. Images must come first,
                                        // because ![foo][f] looks like an anchor.
                                        text = _DoImages(text);
                                        text = _DoAnchors(text);

                                        // Make links out of things like `<http://example.com/>`
                                        // Must come after _DoAnchors(), because you can use < and >
                                        // delimiters in inline links like [this](<url>).
                                        text = _DoAutoLinks(text);
                                        text = _EncodeAmpsAndAngles(text);
                                        text = _DoItalicsAndBold(text);

                                        // Do hard breaks:
                                        text = text.replace(/  +\n/g, " <br />\n");

                                        return text;
                                    }

                                    var _EscapeSpecialCharsWithinTagAttributes = function(text) {
                                        //
                                        // Within tags -- meaning between < and > -- encode [\ ` * _] so they
                                        // don't conflict with their use in Markdown for code, italics and strong.
                                        //

                                        // Build a regex to find HTML tags and comments.  See Friedl's
                                        // "Mastering Regular Expressions", 2nd Ed., pp. 200-201.
                                        var regex = /(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;

                                        text = text.replace(regex, function(wholeMatch) {
                                            var tag = wholeMatch.replace(/(.)<\/?code>(?=.)/g, "$1`");
                                            tag = escapeCharacters(tag, "\\`*_");
                                            return tag;
                                        });

                                        return text;
                                    }

                                    var _DoAnchors = function(text) {
                                        //
                                        // Turn Markdown link shortcuts into XHTML <a> tags.
                                        //
                                        //
                                        // First, handle reference-style links: [link text] [id]
                                        //

                                        /*
                                          text = text.replace(/
                                          (             // wrap whole match in $1
                                            \[
                                            (
                                              (?:
                                                \[[^\]]*\]    // allow brackets nested one level
                                                |
                                                [^\[]     // or anything else
                                              )*
                                            )
                                            \]

                                            [ ]?          // one optional space
                                            (?:\n[ ]*)?       // one optional newline followed by spaces

                                            \[
                                            (.*?)         // id = $3
                                            \]
                                          )()()()()         // pad remaining backreferences
                                          /g,_DoAnchors_callback);
                                        */
                                        text = text.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g, writeAnchorTag);

                                        //
                                        // Next, inline-style links: [link text](url "optional title")
                                        //

                                        /*
                                          text = text.replace(/
                                            (           // wrap whole match in $1
                                              \[
                                              (
                                                (?:
                                                  \[[^\]]*\]  // allow brackets nested one level
                                                |
                                                [^\[\]]     // or anything else
                                              )
                                            )
                                            \]
                                            \(            // literal paren
                                            [ \t]*
                                            ()            // no id, so leave $3 empty
                                            <?(.*?)>?       // href = $4
                                            [ \t]*
                                            (           // $5
                                              (['"])        // quote char = $6
                                              (.*?)       // Title = $7
                                              \6          // matching quote
                                              [ \t]*        // ignore any spaces/tabs between closing quote and )
                                            )?            // title is optional
                                            \)
                                          )
                                          /g,writeAnchorTag);
                                        */
                                        text = text.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g, writeAnchorTag);

                                        //
                                        // Last, handle reference-style shortcuts: [link text]
                                        // These must come last in case you've also got [link test][1]
                                        // or [link test](/foo)
                                        //

                                        /*
                                          text = text.replace(/
                                          (             // wrap whole match in $1
                                            \[
                                            ([^\[\]]+)        // link text = $2; can't contain '[' or ']'
                                            \]
                                          )()()()()()         // pad rest of backreferences
                                          /g, writeAnchorTag);
                                        */
                                        text = text.replace(/(\[([^\[\]]+)\])()()()()()/g, writeAnchorTag);

                                        return text;
                                    }

                                    var writeAnchorTag = function(wholeMatch, m1, m2, m3, m4, m5, m6, m7) {
                                        if (m7 == undefined) m7 = "";
                                        var whole_match = m1;
                                        var link_text = m2;
                                        var link_id = m3.toLowerCase();
                                        var url = m4;
                                        var title = m7;

                                        if (url == "") {
                                            if (link_id == "") {
                                                // lower-case and turn embedded newlines into spaces
                                                link_id = link_text.toLowerCase().replace(/ ?\n/g, " ");
                                            }
                                            url = "#" + link_id;

                                            if (g_urls[link_id] != undefined) {
                                                url = g_urls[link_id];
                                                if (g_titles[link_id] != undefined) {
                                                    title = g_titles[link_id];
                                                }
                                            } else {
                                                if (whole_match.search(/\(\s*\)$/m) > -1) {
                                                    // Special case for explicit empty url
                                                    url = "";
                                                } else {
                                                    return whole_match;
                                                }
                                            }
                                        }

                                        url = escapeCharacters(url, "*_");
                                        var result = "<a href=\"" + url + "\"";

                                        if (title != "") {
                                            title = title.replace(/"/g, "&quot;");
                                            title = escapeCharacters(title, "*_");
                                            result += " title=\"" + title + "\"";
                                        }

                                        result += ">" + link_text + "</a>";

                                        return result;
                                    }


                                    var _DoImages = function(text) {
                                        //
                                        // Turn Markdown image shortcuts into <img> tags.
                                        //

                                        //
                                        // First, handle reference-style labeled images: ![alt text][id]
                                        //

                                        /*
                                          text = text.replace(/
                                          (           // wrap whole match in $1
                                            !\[
                                            (.*?)       // alt text = $2
                                            \]

                                            [ ]?        // one optional space
                                            (?:\n[ ]*)?     // one optional newline followed by spaces

                                            \[
                                            (.*?)       // id = $3
                                            \]
                                          )()()()()       // pad rest of backreferences
                                          /g,writeImageTag);
                                        */
                                        text = text.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g, writeImageTag);

                                        //
                                        // Next, handle inline images:  ![alt text](url "optional title")
                                        // Don't forget: encode * and _

                                        /*
                                          text = text.replace(/
                                          (           // wrap whole match in $1
                                            !\[
                                            (.*?)       // alt text = $2
                                            \]
                                            \s?         // One optional whitespace character
                                            \(          // literal paren
                                            [ \t]*
                                            ()          // no id, so leave $3 empty
                                            <?(\S+?)>?      // src url = $4
                                            [ \t]*
                                            (         // $5
                                              (['"])      // quote char = $6
                                              (.*?)     // title = $7
                                              \6        // matching quote
                                              [ \t]*
                                            )?          // title is optional
                                          \)
                                          )
                                          /g,writeImageTag);
                                        */
                                        text = text.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g, writeImageTag);

                                        return text;
                                    }

                                    var writeImageTag = function(wholeMatch, m1, m2, m3, m4, m5, m6, m7) {
                                        var whole_match = m1;
                                        var alt_text = m2;
                                        var link_id = m3.toLowerCase();
                                        var url = m4;
                                        var title = m7;

                                        if (!title) title = "";

                                        if (url == "") {
                                            if (link_id == "") {
                                                // lower-case and turn embedded newlines into spaces
                                                link_id = alt_text.toLowerCase().replace(/ ?\n/g, " ");
                                            }
                                            url = "#" + link_id;

                                            if (g_urls[link_id] != undefined) {
                                                url = g_urls[link_id];
                                                if (g_titles[link_id] != undefined) {
                                                    title = g_titles[link_id];
                                                }
                                            } else {
                                                return whole_match;
                                            }
                                        }

                                        alt_text = alt_text.replace(/"/g, "&quot;");
                                        url = escapeCharacters(url, "*_");
                                        var result = "<img src=\"" + url + "\" alt=\"" + alt_text + "\"";

                                        // attacklab: Markdown.pl adds empty title attributes to images.
                                        // Replicate this bug.

                                        //if (title != "") {
                                        title = title.replace(/"/g, "&quot;");
                                        title = escapeCharacters(title, "*_");
                                        result += " title=\"" + title + "\"";
                                        //}

                                        result += " />";

                                        return result;
                                    }


                                    var _DoHeaders = function(text) {

                                        // Setext-style headers:
                                        //  Header 1
                                        //  ========
                                        //
                                        //  Header 2
                                        //  --------
                                        //
                                        text = text.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,
                                            function(wholeMatch, m1) {
                                                return hashBlock("<h1>" + _RunSpanGamut(m1) + "</h1>");
                                            });

                                        text = text.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,
                                            function(matchFound, m1) {
                                                return hashBlock("<h2>" + _RunSpanGamut(m1) + "</h2>");
                                            });

                                        // atx-style headers:
                                        //  # Header 1
                                        //  ## Header 2
                                        //  ## Header 2 with closing hashes ##
                                        //  ...
                                        //  ###### Header 6
                                        //

                                        /*
                                          text = text.replace(/
                                            ^(\#{1,6})        // $1 = string of #'s
                                            [ \t]*
                                            (.+?)         // $2 = Header text
                                            [ \t]*
                                            \#*           // optional closing #'s (not counted)
                                            \n+
                                          /gm, function() {...});
                                        */

                                        text = text.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,
                                            function(wholeMatch, m1, m2) {
                                                var h_level = m1.length;
                                                return hashBlock("<h" + h_level + ">" + _RunSpanGamut(m2) + "</h" + h_level + ">");
                                            });

                                        return text;
                                    }

                                    // This declaration keeps Dojo compressor from outputting garbage:
                                    var _ProcessListItems;

                                    var _DoLists = function(text) {
                                        //
                                        // Form HTML ordered (numbered) and unordered (bulleted) lists.
                                        //

                                        // attacklab: add sentinel to hack around khtml/safari bug:
                                        // http://bugs.webkit.org/show_bug.cgi?id=11231
                                        text += "~0";

                                        // Re-usable pattern to match any entirel ul or ol list:

                                        /*
                                          var whole_list = /
                                          (                 // $1 = whole list
                                            (               // $2
                                              [ ]{0,3}          // attacklab: g_tab_width - 1
                                              ([*+-]|\d+[.])        // $3 = first list item marker
                                              [ \t]+
                                            )
                                            [^\r]+?
                                            (               // $4
                                              ~0              // sentinel for workaround; should be $
                                            |
                                              \n{2,}
                                              (?=\S)
                                              (?!             // Negative lookahead for another list item marker
                                                [ \t]*
                                                (?:[*+-]|\d+[.])[ \t]+
                                              )
                                            )
                                          )/g
                                        */
                                        var whole_list = /^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;

                                        if (g_list_level) {
                                            text = text.replace(whole_list, function(wholeMatch, m1, m2) {
                                                var list = m1;
                                                var list_type = (m2.search(/[*+-]/g) > -1) ? "ul" : "ol";

                                                // Turn double returns into triple returns, so that we can make a
                                                // paragraph for the last item in a list, if necessary:
                                                list = list.replace(/\n{2,}/g, "\n\n\n");;
                                                var result = _ProcessListItems(list);

                                                // Trim any trailing whitespace, to put the closing `</$list_type>`
                                                // up on the preceding line, to get it past the current stupid
                                                // HTML block parser. This is a hack to work around the terrible
                                                // hack that is the HTML block parser.
                                                result = result.replace(/\s+$/, "");
                                                result = "<" + list_type + ">" + result + "</" + list_type + ">\n";
                                                return result;
                                            });
                                        } else {
                                            whole_list = /(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g;
                                            text = text.replace(whole_list, function(wholeMatch, m1, m2, m3) {
                                                var runup = m1;
                                                var list = m2;

                                                var list_type = (m3.search(/[*+-]/g) > -1) ? "ul" : "ol";
                                                // Turn double returns into triple returns, so that we can make a
                                                // paragraph for the last item in a list, if necessary:
                                                var list = list.replace(/\n{2,}/g, "\n\n\n");;
                                                var result = _ProcessListItems(list);
                                                result = runup + "<" + list_type + ">\n" + result + "</" + list_type + ">\n";
                                                return result;
                                            });
                                        }

                                        // attacklab: strip sentinel
                                        text = text.replace(/~0/, "");

                                        return text;
                                    }

                                    _ProcessListItems = function(list_str) {
                                        //
                                        //  Process the contents of a single ordered or unordered list, splitting it
                                        //  into individual list items.
                                        //
                                        // The $g_list_level global keeps track of when we're inside a list.
                                        // Each time we enter a list, we increment it; when we leave a list,
                                        // we decrement. If it's zero, we're not in a list anymore.
                                        //
                                        // We do this because when we're not inside a list, we want to treat
                                        // something like this:
                                        //
                                        //    I recommend upgrading to version
                                        //    8. Oops, now this line is treated
                                        //    as a sub-list.
                                        //
                                        // As a single paragraph, despite the fact that the second line starts
                                        // with a digit-period-space sequence.
                                        //
                                        // Whereas when we're inside a list (or sub-list), that line will be
                                        // treated as the start of a sub-list. What a kludge, huh? This is
                                        // an aspect of Markdown's syntax that's hard to parse perfectly
                                        // without resorting to mind-reading. Perhaps the solution is to
                                        // change the syntax rules such that sub-lists must start with a
                                        // starting cardinal number; e.g. "1." or "a.".

                                        g_list_level++;

                                        // trim trailing blank lines:
                                        list_str = list_str.replace(/\n{2,}$/, "\n");

                                        // attacklab: add sentinel to emulate \z
                                        list_str += "~0";

                                        /*
                                          list_str = list_str.replace(/
                                            (\n)?             // leading line = $1
                                            (^[ \t]*)           // leading whitespace = $2
                                            ([*+-]|\d+[.]) [ \t]+     // list marker = $3
                                            ([^\r]+?            // list item text   = $4
                                            (\n{1,2}))
                                            (?= \n* (~0 | \2 ([*+-]|\d+[.]) [ \t]+))
                                          /gm, function(){...});
                                        */
                                        list_str = list_str.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,
                                            function(wholeMatch, m1, m2, m3, m4) {
                                                var item = m4;
                                                var leading_line = m1;
                                                var leading_space = m2;

                                                if (leading_line || (item.search(/\n{2,}/) > -1)) {
                                                    item = _RunBlockGamut(_Outdent(item));
                                                } else {
                                                    // Recursion for sub-lists:
                                                    item = _DoLists(_Outdent(item));
                                                    item = item.replace(/\n$/, ""); // chomp(item)
                                                    item = _RunSpanGamut(item);
                                                }

                                                return "<li>" + item + "</li>\n";
                                            }
                                        );

                                        // attacklab: strip sentinel
                                        list_str = list_str.replace(/~0/g, "");

                                        g_list_level--;
                                        return list_str;
                                    }


                                    var _DoCodeBlocks = function(text) {
                                        //
                                        //  Process Markdown `<pre><code>` blocks.
                                        //

                                        /*
                                          text = text.replace(text,
                                            /(?:\n\n|^)
                                            (               // $1 = the code block -- one or more lines, starting with a space/tab
                                              (?:
                                                (?:[ ]{4}|\t)     // Lines must start with a tab or a tab-width of spaces - attacklab: g_tab_width
                                                .*\n+
                                              )+
                                            )
                                            (\n*[ ]{0,3}[^ \t\n]|(?=~0))  // attacklab: g_tab_width
                                          /g,function(){...});
                                        */

                                        // attacklab: sentinel workarounds for lack of \A and \Z, safari\khtml bug
                                        text += "~0";

                                        text = text.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,
                                            function(wholeMatch, m1, m2) {
                                                var codeblock = m1;
                                                var nextChar = m2;

                                                codeblock = _EncodeCode(_Outdent(codeblock));
                                                codeblock = _Detab(codeblock);
                                                codeblock = codeblock.replace(/^\n+/g, ""); // trim leading newlines
                                                codeblock = codeblock.replace(/\n+$/g, ""); // trim trailing whitespace

                                                codeblock = "<pre><code>" + codeblock + "\n</code></pre>";

                                                return hashBlock(codeblock) + nextChar;
                                            }
                                        );

                                        // attacklab: strip sentinel
                                        text = text.replace(/~0/, "");

                                        return text;
                                    }

                                    var hashBlock = function(text) {
                                        text = text.replace(/(^\n+|\n+$)/g, "");
                                        return "\n\n~K" + (g_html_blocks.push(text) - 1) + "K\n\n";
                                    }


                                    var _DoCodeSpans = function(text) {
                                        //
                                        //   *  Backtick quotes are used for <code></code> spans.
                                        //
                                        //   *  You can use multiple backticks as the delimiters if you want to
                                        //   include literal backticks in the code span. So, this input:
                                        //
                                        //     Just type ``foo `bar` baz`` at the prompt.
                                        //
                                        //     Will translate to:
                                        //
                                        //     <p>Just type <code>foo `bar` baz</code> at the prompt.</p>
                                        //
                                        //  There's no arbitrary limit to the number of backticks you
                                        //  can use as delimters. If you need three consecutive backticks
                                        //  in your code, use four for delimiters, etc.
                                        //
                                        //  *  You can use spaces to get literal backticks at the edges:
                                        //
                                        //     ... type `` `bar` `` ...
                                        //
                                        //     Turns to:
                                        //
                                        //     ... type <code>`bar`</code> ...
                                        //

                                        /*
                                          text = text.replace(/
                                            (^|[^\\])         // Character before opening ` can't be a backslash
                                            (`+)            // $2 = Opening run of `
                                            (             // $3 = The code block
                                              [^\r]*?
                                              [^`]          // attacklab: work around lack of lookbehind
                                            )
                                            \2              // Matching closer
                                            (?!`)
                                          /gm, function(){...});
                                        */

                                        text = text.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,
                                            function(wholeMatch, m1, m2, m3, m4) {
                                                var c = m3;
                                                c = c.replace(/^([ \t]*)/g, ""); // leading whitespace
                                                c = c.replace(/[ \t]*$/g, ""); // trailing whitespace
                                                c = _EncodeCode(c);
                                                return m1 + "<code>" + c + "</code>";
                                            });

                                        return text;
                                    }


                                    var _EncodeCode = function(text) {
                                        //
                                        // Encode/escape certain characters inside Markdown code runs.
                                        // The point is that in code, these characters are literals,
                                        // and lose their special Markdown meanings.
                                        //
                                        // Encode all ampersands; HTML entities are not
                                        // entities within a Markdown code span.
                                        text = text.replace(/&/g, "&amp;");

                                        // Do the angle bracket song and dance:
                                        text = text.replace(/</g, "&lt;");
                                        text = text.replace(/>/g, "&gt;");

                                        // Now, escape characters that are magic in Markdown:
                                        text = escapeCharacters(text, "\*_{}[]\\", false);

                                        // jj the line above breaks this:
                                        //---

                                        //* Item

                                        //   1. Subitem

                                        //            special char: *
                                        //---

                                        return text;
                                    }


                                    var _DoItalicsAndBold = function(text) {

                                        // <strong> must go first:
                                        text = text.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,
                                            "<strong>$2</strong>");

                                        text = text.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,
                                            "<em>$2</em>");

                                        return text;
                                    }


                                    var _DoBlockQuotes = function(text) {

                                        /*
                                          text = text.replace(/
                                          (               // Wrap whole match in $1
                                            (
                                              ^[ \t]*>[ \t]?      // '>' at the start of a line
                                              .+\n          // rest of the first line
                                              (.+\n)*         // subsequent consecutive lines
                                              \n*           // blanks
                                            )+
                                          )
                                          /gm, function(){...});
                                        */

                                        text = text.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,
                                            function(wholeMatch, m1) {
                                                var bq = m1;

                                                // attacklab: hack around Konqueror 3.5.4 bug:
                                                // "----------bug".replace(/^-/g,"") == "bug"

                                                bq = bq.replace(/^[ \t]*>[ \t]?/gm, "~0"); // trim one level of quoting

                                                // attacklab: clean up hack
                                                bq = bq.replace(/~0/g, "");

                                                bq = bq.replace(/^[ \t]+$/gm, ""); // trim whitespace-only lines
                                                bq = _RunBlockGamut(bq); // recurse

                                                bq = bq.replace(/(^|\n)/g, "$1  ");
                                                // These leading spaces screw with <pre> content, so we need to fix that:
                                                bq = bq.replace(
                                                    /(\s*<pre>[^\r]+?<\/pre>)/gm,
                                                    function(wholeMatch, m1) {
                                                        var pre = m1;
                                                        // attacklab: hack around Konqueror 3.5.4 bug:
                                                        pre = pre.replace(/^  /mg, "~0");
                                                        pre = pre.replace(/~0/g, "");
                                                        return pre;
                                                    });

                                                return hashBlock("<blockquote>\n" + bq + "\n</blockquote>");
                                            });
                                        return text;
                                    }


                                    var _FormParagraphs = function(text) {
                                        //
                                        //  Params:
                                        //    $text - string to process with html <p> tags
                                        //

                                        // Strip leading and trailing lines:
                                        text = text.replace(/^\n+/g, "");
                                        text = text.replace(/\n+$/g, "");

                                        var grafs = text.split(/\n{2,}/g);
                                        var grafsOut = new Array();

                                        //
                                        // Wrap <p> tags.
                                        //
                                        var end = grafs.length;
                                        for (var i = 0; i < end; i++) {
                                            var str = grafs[i];

                                            // if this is an HTML marker, copy it
                                            if (str.search(/~K(\d+)K/g) >= 0) {
                                                grafsOut.push(str);
                                            } else if (str.search(/\S/) >= 0) {
                                                str = _RunSpanGamut(str);
                                                str = str.replace(/^([ \t]*)/g, "<p>");
                                                str += "</p>"
                                                grafsOut.push(str);
                                            }

                                        }

                                        //
                                        // Unhashify HTML blocks
                                        //
                                        end = grafsOut.length;
                                        for (var i = 0; i < end; i++) {
                                            // if this is a marker for an html block...
                                            while (grafsOut[i].search(/~K(\d+)K/) >= 0) {
                                                var blockText = g_html_blocks[RegExp.$1];
                                                blockText = blockText.replace(/\$/g, "$$$$"); // Escape any dollar signs
                                                grafsOut[i] = grafsOut[i].replace(/~K\d+K/, blockText);
                                            }
                                        }

                                        return grafsOut.join("\n\n");
                                    }


                                    var _EncodeAmpsAndAngles = function(text) {
                                        // Smart processing for ampersands and angle brackets that need to be encoded.

                                        // Ampersand-encoding based entirely on Nat Irons's Amputator MT plugin:
                                        //   http://bumppo.net/projects/amputator/
                                        text = text.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g, "&amp;");

                                        // Encode naked <'s
                                        text = text.replace(/<(?![a-z\/?\$!])/gi, "&lt;");

                                        return text;
                                    }


                                    var _EncodeBackslashEscapes = function(text) {
                                        //
                                        //   Parameter:  String.
                                        //   Returns: The string, with after processing the following backslash
                                        //         escape sequences.
                                        //

                                        // attacklab: The polite way to do this is with the new
                                        // escapeCharacters() function:
                                        //
                                        //  text = escapeCharacters(text,"\\",true);
                                        //  text = escapeCharacters(text,"`*_{}[]()>#+-.!",true);
                                        //
                                        // ...but we're sidestepping its use of the (slow) RegExp constructor
                                        // as an optimization for Firefox.  This function gets called a LOT.

                                        text = text.replace(/\\(\\)/g, escapeCharacters_callback);
                                        text = text.replace(/\\([`*_{}\[\]()>#+-.!])/g, escapeCharacters_callback);
                                        return text;
                                    }


                                    var _DoAutoLinks = function(text) {

                                        text = text.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi, "<a href=\"$1\">$1</a>");

                                        // Email addresses: <address@domain.foo>

                                        /*
                                          text = text.replace(/
                                            <
                                            (?:mailto:)?
                                            (
                                              [-.\w]+
                                              \@
                                              [-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+
                                            )
                                            >
                                          /gi, _DoAutoLinks_callback());
                                        */
                                        text = text.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,
                                            function(wholeMatch, m1) {
                                                return _EncodeEmailAddress(_UnescapeSpecialChars(m1));
                                            }
                                        );

                                        return text;
                                    }


                                    var _EncodeEmailAddress = function(addr) {
                                        //
                                        //  Input: an email address, e.g. "foo@example.com"
                                        //
                                        //  Output: the email address as a mailto link, with each character
                                        //  of the address encoded as either a decimal or hex entity, in
                                        //  the hopes of foiling most address harvesting spam bots. E.g.:
                                        //
                                        //  <a href="&#x6D;&#97;&#105;&#108;&#x74;&#111;:&#102;&#111;&#111;&#64;&#101;
                                        //     x&#x61;&#109;&#x70;&#108;&#x65;&#x2E;&#99;&#111;&#109;">&#102;&#111;&#111;
                                        //     &#64;&#101;x&#x61;&#109;&#x70;&#108;&#x65;&#x2E;&#99;&#111;&#109;</a>
                                        //
                                        //  Based on a filter by Matthew Wickline, posted to the BBEdit-Talk
                                        //  mailing list: <http://tinyurl.com/yu7ue>
                                        //

                                        // attacklab: why can't javascript speak hex?
                                        function char2hex(ch) {
                                            var hexDigits = '0123456789ABCDEF';
                                            var dec = ch.charCodeAt(0);
                                            return (hexDigits.charAt(dec >> 4) + hexDigits.charAt(dec & 15));
                                        }

                                        var encode = [
                                            function(ch) {
                                                return "&#" + ch.charCodeAt(0) + ";";
                                            },
                                            function(ch) {
                                                return "&#x" + char2hex(ch) + ";";
                                            },
                                            function(ch) {
                                                return ch;
                                            }
                                        ];

                                        addr = "mailto:" + addr;

                                        addr = addr.replace(/./g, function(ch) {
                                            if (ch == "@") {
                                                // this *must* be encoded. I insist.
                                                ch = encode[Math.floor(Math.random() * 2)](ch);
                                            } else if (ch != ":") {
                                                // leave ':' alone (to spot mailto: later)
                                                var r = Math.random();
                                                // roughly 10% raw, 45% hex, 45% dec
                                                ch = (
                                                    r > .9 ? encode[2](ch) :
                                                    r > .45 ? encode[1](ch) :
                                                    encode[0](ch)
                                                );
                                            }
                                            return ch;
                                        });

                                        addr = "<a href=\"" + addr + "\">" + addr + "</a>";
                                        addr = addr.replace(/">.+:/g, "\">"); // strip the mailto: from the visible part

                                        return addr;
                                    }


                                    var _UnescapeSpecialChars = function(text) {
                                        //
                                        // Swap back in all the special characters we've hidden.
                                        //
                                        text = text.replace(/~E(\d+)E/g,
                                            function(wholeMatch, m1) {
                                                var charCodeToReplace = parseInt(m1);
                                                return String.fromCharCode(charCodeToReplace);
                                            }
                                        );
                                        return text;
                                    }


                                    var _Outdent = function(text) {
                                        //
                                        // Remove one level of line-leading tabs or spaces
                                        //

                                        // attacklab: hack around Konqueror 3.5.4 bug:
                                        // "----------bug".replace(/^-/g,"") == "bug"

                                        text = text.replace(/^(\t|[ ]{1,4})/gm, "~0"); // attacklab: g_tab_width

                                        // attacklab: clean up hack
                                        text = text.replace(/~0/g, "")

                                        return text;
                                    }

                                    var _Detab = function(text) {
                                        // attacklab: Detab's completely rewritten for speed.
                                        // In perl we could fix it by anchoring the regexp with \G.
                                        // In javascript we're less fortunate.

                                        // expand first n-1 tabs
                                        text = text.replace(/\t(?=\t)/g, "    "); // attacklab: g_tab_width

                                        // replace the nth with two sentinels
                                        text = text.replace(/\t/g, "~A~B");

                                        // use the sentinel to anchor our regex so it doesn't explode
                                        text = text.replace(/~B(.+?)~A/g,
                                            function(wholeMatch, m1, m2) {
                                                var leadingText = m1;
                                                var numSpaces = 4 - leadingText.length % 4; // attacklab: g_tab_width

                                                // there *must* be a better way to do this:
                                                for (var i = 0; i < numSpaces; i++) leadingText += " ";

                                                return leadingText;
                                            }
                                        );

                                        // clean up sentinels
                                        text = text.replace(/~A/g, "    "); // attacklab: g_tab_width
                                        text = text.replace(/~B/g, "");

                                        return text;
                                    }


                                    //
                                    //  attacklab: Utility functions
                                    //


                                    var escapeCharacters = function(text, charsToEscape, afterBackslash) {
                                        // First we have to escape the escape characters so that
                                        // we can build a character class out of them
                                        var regexString = "([" + charsToEscape.replace(/([\[\]\\])/g, "\\$1") + "])";

                                        if (afterBackslash) {
                                            regexString = "\\\\" + regexString;
                                        }

                                        var regex = new RegExp(regexString, "g");
                                        text = text.replace(regex, escapeCharacters_callback);

                                        return text;
                                    }


                                    var escapeCharacters_callback = function(wholeMatch, m1) {
                                        var charCodeToEscape = m1.charCodeAt(0);
                                        return "~E" + charCodeToEscape + "E";
                                    }

                                } // end of Showdown.converter
                            </script>
                            <script type="text/javascript">
                                /*
                                        Syntax highlighting with language autodetection.

                                        URL:   http://softwaremaniacs.org/soft/highlight/
                                        Author: Ivan Sagalaev <Maniac@SoftwareManiacs.Org>

                                        Contributors:

                                        - Peter Leonov <gojpeg@gmail.com>
                                        - Victor Karamzin <Victor.Karamzin@enterra-inc.com>
                                        - Vsevolod Solovyov <vsevolod.solovyov@gmail.com>
                                        - Anton Kovalyov <anton@kovalyov.net>
                                        - Nikita Ledyaev <lenikita@yandex.ru>

                                        License (BSD):

                                        * Copyright (c) 2006, Ivan Sagalaev
                                        * All rights reserved.
                                        * Redistribution and use in source and binary forms, with or without
                                        * modification, are permitted provided that the following conditions are met:
                                        *
                                        *     * Redistributions of source code must retain the above copyright
                                        *       notice, this list of conditions and the following disclaimer.
                                        *     * Redistributions in binary form must reproduce the above copyright
                                        *       notice, this list of conditions and the following disclaimer in the
                                        *       documentation and/or other materials provided with the distribution.
                                        *     * Neither the name of the University of California, Berkeley nor the
                                        *       names of its contributors may be used to endorse or promote products
                                        *       derived from this software without specific prior written permission.
                                        *
                                        * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND ANY
                                        * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
                                        * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
                                        * DISCLAIMED. IN NO EVENT SHALL THE REGENTS AND CONTRIBUTORS BE LIABLE FOR ANY
                                        * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
                                        * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
                                        * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
                                        * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
                                        * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
                                        * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

                                        */

                                var IDENT_RE = '[a-zA-Z][a-zA-Z0-9_]*';
                                var UNDERSCORE_IDENT_RE = '[a-zA-Z_][a-zA-Z0-9_]*';
                                var NUMBER_RE = '\\b\\d+(\\.\\d+)?';
                                var C_NUMBER_RE = '\\b(0x[A-Za-z0-9]+|\\d+(\\.\\d+)?)';

                                // Common modes
                                var APOS_STRING_MODE = {
                                    className: 'string',
                                    begin: '\'',
                                    end: '(^|[^\\\\])\'',
                                    relevance: 0
                                }
                                var QUOTE_STRING_MODE = {
                                    className: 'string',
                                    begin: '"',
                                    end: '(^|[^\\\\])"',
                                    relevance: 0
                                }
                                var C_LINE_COMMENT_MODE = {
                                    className: 'comment',
                                    begin: '//',
                                    end: '$',
                                    relevance: 0
                                }
                                var C_BLOCK_COMMENT_MODE = {
                                    className: 'comment',
                                    begin: '/\\*',
                                    end: '\\*/'
                                }
                                var HASH_COMMENT_MODE = {
                                    className: 'comment',
                                    begin: '#',
                                    end: '$'
                                }
                                var C_NUMBER_MODE = {
                                    className: 'number',
                                    begin: C_NUMBER_RE,
                                    end: '^',
                                    relevance: 0
                                }

                                var LANGUAGES = {}

                                LANGUAGES.python = {
                                    defaultMode: {
                                        lexems: [UNDERSCORE_IDENT_RE],
                                        illegal: '(</|->)',
                                        contains: ['comment', 'string', 'function', 'class', 'number', 'decorator'],
                                        keywords: {
                                            'and': 1,
                                            'elif': 1,
                                            'is': 1,
                                            'global': 1,
                                            'as': 1,
                                            'in': 1,
                                            'if': 1,
                                            'from': 1,
                                            'raise': 1,
                                            'for': 1,
                                            'except': 1,
                                            'finally': 1,
                                            'print': 1,
                                            'import': 1,
                                            'pass': 1,
                                            'None': 1,
                                            'return': 1,
                                            'exec': 1,
                                            'else': 1,
                                            'break': 1,
                                            'not': 1,
                                            'with': 1,
                                            'class': 1,
                                            'assert': 1,
                                            'yield': 1,
                                            'try': 1,
                                            'while': 1,
                                            'continue': 1,
                                            'del': 1,
                                            'or': 1,
                                            'def': 1,
                                            'lambda': 1
                                        }
                                    },
                                    modes: [{
                                            className: 'function',
                                            lexems: [UNDERSCORE_IDENT_RE],
                                            begin: 'def ',
                                            end: ':',
                                            illegal: '$',
                                            keywords: {
                                                'def': 1
                                            },
                                            contains: ['title', 'params'],
                                            relevance: 10
                                        },
                                        {
                                            className: 'class',
                                            lexems: [UNDERSCORE_IDENT_RE],
                                            begin: 'class ',
                                            end: ':\\s*$',
                                            illegal: '[${]',
                                            keywords: {
                                                'class': 1
                                            },
                                            contains: ['title', 'params'],
                                            relevance: 10
                                        },
                                        {
                                            className: 'title',
                                            begin: UNDERSCORE_IDENT_RE,
                                            end: '^'
                                        },
                                        {
                                            className: 'params',
                                            begin: '\\(',
                                            end: '\\)',
                                            contains: ['string']
                                        },
                                        HASH_COMMENT_MODE,
                                        C_NUMBER_MODE,
                                        {
                                            className: 'string',
                                            begin: '\'\'\'',
                                            end: '\'\'\'',
                                            relevance: 10
                                        },
                                        {
                                            className: 'string',
                                            begin: '"""',
                                            end: '"""',
                                            relevance: 10
                                        },
                                        APOS_STRING_MODE,
                                        QUOTE_STRING_MODE,
                                        {
                                            className: 'string',
                                            begin: 'r\'',
                                            end: '\'',
                                            relevance: 10
                                        },
                                        {
                                            className: 'string',
                                            begin: 'r"',
                                            end: '"',
                                            relevance: 10
                                        },
                                        {
                                            className: 'string',
                                            begin: 'u\'',
                                            end: '(^|[^\\\\])\'',
                                            relevance: 10
                                        },
                                        {
                                            className: 'string',
                                            begin: 'u"',
                                            end: '(^|[^\\\\])"',
                                            relevance: 10
                                        },
                                        {
                                            className: 'string',
                                            begin: 'ur\'',
                                            end: '\'',
                                            relevance: 10
                                        },
                                        {
                                            className: 'string',
                                            begin: 'ur"',
                                            end: '"',
                                            relevance: 10
                                        },
                                        {
                                            className: 'decorator',
                                            begin: '@',
                                            end: '$'
                                        }
                                    ]
                                }; //python

                                var HTML_TAGS = {
                                    'code': 1,
                                    'kbd': 1,
                                    'font': 1,
                                    'noscript': 1,
                                    'style': 1,
                                    'img': 1,
                                    'title': 1,
                                    'menu': 1,
                                    'tt': 1,
                                    'tr': 1,
                                    'param': 1,
                                    'li': 1,
                                    'tfoot': 1,
                                    'th': 1,
                                    'input': 1,
                                    'td': 1,
                                    'dl': 1,
                                    'blockquote': 1,
                                    'fieldset': 1,
                                    'big': 1,
                                    'dd': 1,
                                    'abbr': 1,
                                    'optgroup': 1,
                                    'dt': 1,
                                    'button': 1,
                                    'isindex': 1,
                                    'p': 1,
                                    'small': 1,
                                    'div': 1,
                                    'dir': 1,
                                    'em': 1,
                                    'frame': 1,
                                    'meta': 1,
                                    'sub': 1,
                                    'bdo': 1,
                                    'label': 1,
                                    'acronym': 1,
                                    'sup': 1,
                                    'body': 1,
                                    'xml': 1,
                                    'basefont': 1,
                                    'base': 1,
                                    'br': 1,
                                    'address': 1,
                                    'strong': 1,
                                    'legend': 1,
                                    'ol': 1,
                                    'script': 1,
                                    'caption': 1,
                                    's': 1,
                                    'col': 1,
                                    'h2': 1,
                                    'h3': 1,
                                    'h1': 1,
                                    'h6': 1,
                                    'h4': 1,
                                    'h5': 1,
                                    'table': 1,
                                    'select': 1,
                                    'noframes': 1,
                                    'span': 1,
                                    'area': 1,
                                    'dfn': 1,
                                    'strike': 1,
                                    'cite': 1,
                                    'thead': 1,
                                    'head': 1,
                                    'option': 1,
                                    'form': 1,
                                    'hr': 1,
                                    'var': 1,
                                    'link': 1,
                                    'b': 1,
                                    'colgroup': 1,
                                    'ul': 1,
                                    'applet': 1,
                                    'del': 1,
                                    'iframe': 1,
                                    'pre': 1,
                                    'frameset': 1,
                                    'ins': 1,
                                    'tbody': 1,
                                    'html': 1,
                                    'samp': 1,
                                    'map': 1,
                                    'object': 1,
                                    'a': 1,
                                    'xmlns': 1,
                                    'center': 1,
                                    'textarea': 1,
                                    'i': 1,
                                    'q': 1,
                                    'u': 1
                                };

                                LANGUAGES.html = {
                                    defaultMode: {
                                        contains: ['tag', 'comment']
                                    },
                                    case_insensitive: true,
                                    modes: [{
                                            className: 'comment',
                                            begin: '<!--',
                                            end: '-->'
                                        },
                                        {
                                            className: 'tag',
                                            lexems: [IDENT_RE],
                                            keywords: HTML_TAGS,
                                            begin: '<',
                                            end: '>',
                                            contains: ['attribute']
                                        },
                                        {
                                            className: 'attribute',
                                            begin: ' [a-zA-Z]+=',
                                            end: '^',
                                            contains: ['value']
                                        },
                                        {
                                            className: 'attribute',
                                            begin: ' [a-zA-Z]+',
                                            end: '^'
                                        },
                                        {
                                            className: 'value',
                                            begin: '"',
                                            end: '"'
                                        },
                                        {
                                            className: 'value',
                                            begin: '[a-zA-Z0-9]+',
                                            end: '^'
                                        }
                                    ]
                                }; //html

                                LANGUAGES.css = {
                                    defaultMode: {
                                        contains: ['id', 'class', 'attr_selector', 'rules', 'comment'],
                                        keywords: HTML_TAGS,
                                        lexems: [IDENT_RE],
                                        illegal: '='
                                    },
                                    case_insensitive: true,
                                    modes: [{
                                            className: 'id',
                                            begin: '\\#[A-Za-z0-9_-]+',
                                            end: '^'
                                        },
                                        {
                                            className: 'class',
                                            begin: '\\.[A-Za-z0-9_-]+',
                                            end: '^',
                                            relevance: 0
                                        },
                                        {
                                            className: 'attr_selector',
                                            begin: '\\[',
                                            end: '\\]',
                                            illegal: '$'
                                        },
                                        {
                                            className: 'rules',
                                            begin: '{',
                                            end: '}',
                                            lexems: ['[A-Za-z-]+'],
                                            keywords: {
                                                'play-during': 1,
                                                'counter-reset': 1,
                                                'counter-increment': 1,
                                                'min-height': 1,
                                                'quotes': 1,
                                                'border-top': 1,
                                                'pitch': 1,
                                                'font': 1,
                                                'pause': 1,
                                                'list-style-image': 1,
                                                'border-width': 1,
                                                'cue': 1,
                                                'outline-width': 1,
                                                'border-left': 1,
                                                'elevation': 1,
                                                'richness': 1,
                                                'speech-rate': 1,
                                                'border-bottom': 1,
                                                'border-spacing': 1,
                                                'background': 1,
                                                'list-style-type': 1,
                                                'text-align': 1,
                                                'page-break-inside': 1,
                                                'orphans': 1,
                                                'page-break-before': 1,
                                                'text-transform': 1,
                                                'line-height': 1,
                                                'padding-left': 1,
                                                'font-size': 1,
                                                'right': 1,
                                                'word-spacing': 1,
                                                'padding-top': 1,
                                                'outline-style': 1,
                                                'bottom': 1,
                                                'content': 1,
                                                'border-right-style': 1,
                                                'padding-right': 1,
                                                'border-left-style': 1,
                                                'voice-family': 1,
                                                'background-color': 1,
                                                'border-bottom-color': 1,
                                                'outline-color': 1,
                                                'unicode-bidi': 1,
                                                'max-width': 1,
                                                'font-family': 1,
                                                'caption-side': 1,
                                                'border-right-width': 1,
                                                'pause-before': 1,
                                                'border-top-style': 1,
                                                'color': 1,
                                                'border-collapse': 1,
                                                'border-bottom-width': 1,
                                                'float': 1,
                                                'height': 1,
                                                'max-height': 1,
                                                'margin-right': 1,
                                                'border-top-width': 1,
                                                'speak': 1,
                                                'speak-header': 1,
                                                'top': 1,
                                                'cue-before': 1,
                                                'min-width': 1,
                                                'width': 1,
                                                'font-variant': 1,
                                                'border-top-color': 1,
                                                'background-position': 1,
                                                'empty-cells': 1,
                                                'direction': 1,
                                                'border-right': 1,
                                                'visibility': 1,
                                                'padding': 1,
                                                'border-style': 1,
                                                'background-attachment': 1,
                                                'overflow': 1,
                                                'border-bottom-style': 1,
                                                'cursor': 1,
                                                'margin': 1,
                                                'display': 1,
                                                'border-left-width': 1,
                                                'letter-spacing': 1,
                                                'vertical-align': 1,
                                                'clip': 1,
                                                'border-color': 1,
                                                'list-style': 1,
                                                'padding-bottom': 1,
                                                'pause-after': 1,
                                                'speak-numeral': 1,
                                                'margin-left': 1,
                                                'widows': 1,
                                                'border': 1,
                                                'font-style': 1,
                                                'border-left-color': 1,
                                                'pitch-range': 1,
                                                'background-repeat': 1,
                                                'table-layout': 1,
                                                'margin-bottom': 1,
                                                'speak-punctuation': 1,
                                                'font-weight': 1,
                                                'border-right-color': 1,
                                                'page-break-after': 1,
                                                'position': 1,
                                                'white-space': 1,
                                                'text-indent': 1,
                                                'background-image': 1,
                                                'volume': 1,
                                                'stress': 1,
                                                'outline': 1,
                                                'clear': 1,
                                                'z-index': 1,
                                                'text-decoration': 1,
                                                'margin-top': 1,
                                                'azimuth': 1,
                                                'cue-after': 1,
                                                'left': 1,
                                                'list-style-position': 1
                                            },
                                            contains: ['comment', 'value']
                                        },
                                        C_BLOCK_COMMENT_MODE,
                                        {
                                            className: 'value',
                                            begin: ':',
                                            end: ';',
                                            endsWithParent: true,
                                            excludeBegin: true,
                                            excludeEnd: true
                                        }
                                    ]
                                }; //css

                                var DELPHI_KEYWORDS = {
                                    'and': 1,
                                    'safecall': 1,
                                    'cdecl': 1,
                                    'then': 1,
                                    'string': 1,
                                    'exports': 1,
                                    'library': 1,
                                    'not': 1,
                                    'pascal': 1,
                                    'set': 1,
                                    'virtual': 1,
                                    'file': 1,
                                    'in': 1,
                                    'array': 1,
                                    'label': 1,
                                    'packed': 1,
                                    'end.': 1,
                                    'index': 1,
                                    'while': 1,
                                    'const': 1,
                                    'raise': 1,
                                    'for': 1,
                                    'to': 1,
                                    'implementation': 1,
                                    'with': 1,
                                    'except': 1,
                                    'overload': 1,
                                    'destructor': 1,
                                    'downto': 1,
                                    'finally': 1,
                                    'program': 1,
                                    'exit': 1,
                                    'unit': 1,
                                    'inherited': 1,
                                    'override': 1,
                                    'if': 1,
                                    'type': 1,
                                    'until': 1,
                                    'function': 1,
                                    'do': 1,
                                    'begin': 1,
                                    'repeat': 1,
                                    'goto': 1,
                                    'nil': 1,
                                    'far': 1,
                                    'initialization': 1,
                                    'object': 1,
                                    'else': 1,
                                    'var': 1,
                                    'uses': 1,
                                    'external': 1,
                                    'resourcestring': 1,
                                    'interface': 1,
                                    'end': 1,
                                    'finalization': 1,
                                    'class': 1,
                                    'asm': 1,
                                    'mod': 1,
                                    'case': 1,
                                    'on': 1,
                                    'shr': 1,
                                    'shl': 1,
                                    'of': 1,
                                    'register': 1,
                                    'xorwrite': 1,
                                    'threadvar': 1,
                                    'try': 1,
                                    'record': 1,
                                    'near': 1,
                                    'stored': 1,
                                    'constructor': 1,
                                    'stdcall': 1,
                                    'inline': 1,
                                    'div': 1,
                                    'out': 1,
                                    'or': 1,
                                    'procedure': 1
                                };
                                var DELPHI_CLASS_KEYWORDS = {
                                    'safecall': 1,
                                    'stdcall': 1,
                                    'pascal': 1,
                                    'stored': 1,
                                    'const': 1,
                                    'implementation': 1,
                                    'finalization': 1,
                                    'except': 1,
                                    'to': 1,
                                    'finally': 1,
                                    'program': 1,
                                    'inherited': 1,
                                    'override': 1,
                                    'then': 1,
                                    'exports': 1,
                                    'string': 1,
                                    'read': 1,
                                    'not': 1,
                                    'mod': 1,
                                    'shr': 1,
                                    'try': 1,
                                    'div': 1,
                                    'shl': 1,
                                    'set': 1,
                                    'library': 1,
                                    'message': 1,
                                    'packed': 1,
                                    'index': 1,
                                    'for': 1,
                                    'near': 1,
                                    'overload': 1,
                                    'label': 1,
                                    'downto': 1,
                                    'exit': 1,
                                    'public': 1,
                                    'goto': 1,
                                    'interface': 1,
                                    'asm': 1,
                                    'on': 1,
                                    'of': 1,
                                    'constructor': 1,
                                    'or': 1,
                                    'private': 1,
                                    'array': 1,
                                    'unit': 1,
                                    'raise': 1,
                                    'destructor': 1,
                                    'var': 1,
                                    'type': 1,
                                    'until': 1,
                                    'function': 1,
                                    'else': 1,
                                    'external': 1,
                                    'with': 1,
                                    'case': 1,
                                    'default': 1,
                                    'record': 1,
                                    'while': 1,
                                    'protected': 1,
                                    'property': 1,
                                    'procedure': 1,
                                    'published': 1,
                                    'and': 1,
                                    'cdecl': 1,
                                    'do': 1,
                                    'threadvar': 1,
                                    'file': 1,
                                    'in': 1,
                                    'if': 1,
                                    'end': 1,
                                    'virtual': 1,
                                    'write': 1,
                                    'far': 1,
                                    'out': 1,
                                    'begin': 1,
                                    'repeat': 1,
                                    'nil': 1,
                                    'initialization': 1,
                                    'object': 1,
                                    'uses': 1,
                                    'resourcestring': 1,
                                    'class': 1,
                                    'register': 1,
                                    'xorwrite': 1,
                                    'inline': 1
                                };

                                LANGUAGES.delphi = {
                                    defaultMode: {
                                        lexems: [IDENT_RE],
                                        illegal: '("|\\$[G-Zg-z]|\\/\\*|</)',
                                        contains: ['comment', 'string', 'number', 'function', 'class'],
                                        keywords: DELPHI_KEYWORDS
                                    },
                                    case_insensitive: true,
                                    modes: [{
                                            className: 'comment',
                                            begin: '{',
                                            end: '}'
                                        },
                                        {
                                            className: 'comment',
                                            begin: '\\(\\*',
                                            end: '\\*\\)',
                                            relevance: 10
                                        },
                                        C_LINE_COMMENT_MODE,
                                        {
                                            className: 'number',
                                            begin: NUMBER_RE,
                                            end: '^',
                                            relevance: 0
                                        },
                                        {
                                            className: 'string',
                                            begin: '\'',
                                            end: '\'',
                                            contains: ['quote'],
                                            relevance: 0
                                        },
                                        {
                                            className: 'quote',
                                            begin: '\'\'',
                                            end: '^'
                                        },
                                        {
                                            className: 'function',
                                            begin: 'function',
                                            end: '[:;]',
                                            lexems: [IDENT_RE],
                                            keywords: {
                                                'function': 1
                                            },
                                            contains: ['title', 'params', 'comment'],
                                            relevance: 0
                                        },
                                        {
                                            className: 'function',
                                            begin: '(procedure|constructor|destructor)',
                                            end: ';',
                                            lexems: [IDENT_RE],
                                            keywords: {
                                                'constructor': 1,
                                                'destructor': 1,
                                                'procedure': 1
                                            },
                                            contains: ['title', 'params', 'comment'],
                                            relevance: 10
                                        },
                                        {
                                            className: 'title',
                                            begin: IDENT_RE,
                                            end: '^'
                                        },
                                        {
                                            className: 'params',
                                            begin: '\\(',
                                            end: '\\)',
                                            lexems: [IDENT_RE],
                                            keywords: DELPHI_KEYWORDS,
                                            contains: ['string']
                                        },
                                        {
                                            className: 'class',
                                            begin: '=\\s*class',
                                            end: 'end;',
                                            lexems: [IDENT_RE],
                                            keywords: DELPHI_CLASS_KEYWORDS,
                                            contains: ['string', 'comment', 'function']
                                        }
                                    ]
                                }; //delphi

                                /*

                                Perl definition () Peter Leonov <gojpeg@gmail.com>
                                Test you perl code here: http://wiki.cmsbuilder.ru/Highlite_test

                                */

                                var PERL_NUMBER_RE = '(\\b0[0-7]+)|(\\b0x[0-9a-fA-F]+)|(\\b[1-9]\\d*(\\.\\d+)?)';
                                var PERL_KYEWORDS = {
                                    'getpwent': 1,
                                    'getservent': 1,
                                    'quotemeta': 1,
                                    'msgrcv': 1,
                                    'scalar': 1,
                                    'kill': 1,
                                    'dbmclose': 1,
                                    'undef': 1,
                                    'lc': 1,
                                    'ma': 1,
                                    'syswrite': 1,
                                    'tr': 1,
                                    'send': 1,
                                    'umask': 1,
                                    'sysopen': 1,
                                    'shmwrite': 1,
                                    'vec': 1,
                                    'qx': 1,
                                    'utime': 1,
                                    'local': 1,
                                    'oct': 1,
                                    'semctl': 1,
                                    'localtime': 1,
                                    'readpipe': 1,
                                    'do': 1,
                                    'return': 1,
                                    'format': 1,
                                    'read': 1,
                                    'sprintf': 1,
                                    'dbmopen': 1,
                                    'pop': 1,
                                    'getpgrp': 1,
                                    'not': 1,
                                    'getpwnam': 1,
                                    'rewinddir': 1,
                                    'qq': 1,
                                    'fileno': 1,
                                    'qw': 1,
                                    'endprotoent': 1,
                                    'wait': 1,
                                    'sethostent': 1,
                                    'bless': 1,
                                    's': 1,
                                    'opendir': 1,
                                    'continue': 1,
                                    'each': 1,
                                    'sleep': 1,
                                    'endgrent': 1,
                                    'shutdown': 1,
                                    'dump': 1,
                                    'chomp': 1,
                                    'connect': 1,
                                    'getsockname': 1,
                                    'die': 1,
                                    'socketpair': 1,
                                    'close': 1,
                                    'flock': 1,
                                    'exists': 1,
                                    'index': 1,
                                    'shmget': 1,
                                    'sub': 1,
                                    'for': 1,
                                    'endpwent': 1,
                                    'redo': 1,
                                    'lstat': 1,
                                    'msgctl': 1,
                                    'setpgrp': 1,
                                    'abs': 1,
                                    'exit': 1,
                                    'select': 1,
                                    'print': 1,
                                    'ref': 1,
                                    'gethostbyaddr': 1,
                                    'unshift': 1,
                                    'fcntl': 1,
                                    'syscall': 1,
                                    'goto': 1,
                                    'getnetbyaddr': 1,
                                    'join': 1,
                                    'gmtime': 1,
                                    'symlink': 1,
                                    'semget': 1,
                                    'splice': 1,
                                    'x': 1,
                                    'getpeername': 1,
                                    'recv': 1,
                                    'log': 1,
                                    'setsockopt': 1,
                                    'cos': 1,
                                    'last': 1,
                                    'reverse': 1,
                                    'gethostbyname': 1,
                                    'getgrnam': 1,
                                    'study': 1,
                                    'formline': 1,
                                    'endhostent': 1,
                                    'times': 1,
                                    'chop': 1,
                                    'length': 1,
                                    'gethostent': 1,
                                    'getnetent': 1,
                                    'pack': 1,
                                    'getprotoent': 1,
                                    'getservbyname': 1,
                                    'rand': 1,
                                    'mkdir': 1,
                                    'pos': 1,
                                    'chmod': 1,
                                    'y': 1,
                                    'substr': 1,
                                    'endnetent': 1,
                                    'printf': 1,
                                    'next': 1,
                                    'open': 1,
                                    'msgsnd': 1,
                                    'readdir': 1,
                                    'use': 1,
                                    'unlink': 1,
                                    'getsockopt': 1,
                                    'getpriority': 1,
                                    'rindex': 1,
                                    'wantarray': 1,
                                    'hex': 1,
                                    'system': 1,
                                    'getservbyport': 1,
                                    'endservent': 1,
                                    'int': 1,
                                    'chr': 1,
                                    'untie': 1,
                                    'rmdir': 1,
                                    'prototype': 1,
                                    'tell': 1,
                                    'listen': 1,
                                    'fork': 1,
                                    'shmread': 1,
                                    'ucfirst': 1,
                                    'setprotoent': 1,
                                    'else': 1,
                                    'sysseek': 1,
                                    'link': 1,
                                    'getgrgid': 1,
                                    'shmctl': 1,
                                    'waitpid': 1,
                                    'unpack': 1,
                                    'getnetbyname': 1,
                                    'reset': 1,
                                    'chdir': 1,
                                    'grep': 1,
                                    'split': 1,
                                    'require': 1,
                                    'caller': 1,
                                    'lcfirst': 1,
                                    'until': 1,
                                    'warn': 1,
                                    'while': 1,
                                    'values': 1,
                                    'shift': 1,
                                    'telldir': 1,
                                    'getpwuid': 1,
                                    'my': 1,
                                    'getprotobynumber': 1,
                                    'delete': 1,
                                    'and': 1,
                                    'sort': 1,
                                    'uc': 1,
                                    'defined': 1,
                                    'srand': 1,
                                    'accept': 1,
                                    'package': 1,
                                    'seekdir': 1,
                                    'getprotobyname': 1,
                                    'semop': 1,
                                    'our': 1,
                                    'rename': 1,
                                    'seek': 1,
                                    'if': 1,
                                    'q': 1,
                                    'chroot': 1,
                                    'sysread': 1,
                                    'setpwent': 1,
                                    'no': 1,
                                    'crypt': 1,
                                    'getc': 1,
                                    'chown': 1,
                                    'sqrt': 1,
                                    'write': 1,
                                    'setnetent': 1,
                                    'setpriority': 1,
                                    'foreach': 1,
                                    'tie': 1,
                                    'sin': 1,
                                    'msgget': 1,
                                    'map': 1,
                                    'stat': 1,
                                    'getlogin': 1,
                                    'unless': 1,
                                    'elsif': 1,
                                    'truncate': 1,
                                    'exec': 1,
                                    'keys': 1,
                                    'glob': 1,
                                    'tied': 1,
                                    'closedir': 1,
                                    'ioctl': 1,
                                    'socket': 1,
                                    'readlink': 1,
                                    'eval': 1,
                                    'xor': 1,
                                    'readline': 1,
                                    'binmode': 1,
                                    'setservent': 1,
                                    'eof': 1,
                                    'ord': 1,
                                    'bind': 1,
                                    'alarm': 1,
                                    'pipe': 1,
                                    'atan2': 1,
                                    'getgrent': 1,
                                    'exp': 1,
                                    'time': 1,
                                    'push': 1,
                                    'setgrent': 1,
                                    'gt': 1,
                                    'lt': 1,
                                    'or': 1,
                                    'ne': 1,
                                    'm': 1
                                };

                                LANGUAGES.perl = {
                                    defaultMode: {
                                        lexems: [IDENT_RE],
                                        contains: ['comment', 'string', 'number', 'regexp', 'sub', 'variable', 'operator', 'pod'],
                                        keywords: PERL_KYEWORDS
                                    },
                                    modes: [

                                        // variables
                                        {
                                            className: 'variable',
                                            begin: '[\\$\\%\\@\\*]([^\\s\\w{#]|{\\w+}|#?\\w+)',
                                            end: '^'
                                        },

                                        // numbers and strings
                                        {
                                            className: 'number',
                                            begin: PERL_NUMBER_RE,
                                            end: '^',
                                            relevance: 0
                                        },
                                        {
                                            className: 'string',
                                            begin: 'q[qwxr]?\\(',
                                            end: '[^\\\\]\\)',
                                            relevance: 10
                                        },
                                        APOS_STRING_MODE,
                                        QUOTE_STRING_MODE,
                                        {
                                            className: 'string',
                                            begin: '`',
                                            end: '(^|[^\\\\])`',
                                            relevance: 0
                                        },

                                        // operators
                                        {
                                            className: 'operator',
                                            begin: '\\s-\\w',
                                            end: '^'
                                        },

                                        // regexps
                                        {
                                            className: 'regexp',
                                            begin: '(s|tr|y)(\\/.*?[^\\\\]\\/|\\/\\/)(.*?[^\\\\]\\/|\\/)[a-z]*',
                                            end: '^',
                                            relevance: 10
                                        },
                                        {
                                            className: 'regexp',
                                            begin: '(m|qr)?\\/\\/[cgimosxe]*',
                                            end: '^',
                                            relevance: 0 // allows empty "//" which is a common comment delimiter in other languages
                                        },
                                        {
                                            className: 'regexp',
                                            begin: '(m|qr)?\\/.*?[^\\\\/]\\/[cgimosxe]*',
                                            end: '^'
                                        },

                                        // bareword context
                                        {
                                            className: 'string',
                                            begin: '{\\w+}',
                                            end: '^',
                                            relevance: 0
                                        },
                                        {
                                            className: 'string',
                                            begin: '\-?\\w+\\s*\\=\\>',
                                            end: '^',
                                            relevance: 5
                                        },

                                        // subroutines
                                        {
                                            className: 'sub',
                                            begin: 'sub\\b',
                                            end: '\\w+',
                                            lexems: [IDENT_RE],
                                            keywords: {
                                                'sub': 1
                                            },
                                            relevance: 10
                                        },

                                        // comments
                                        HASH_COMMENT_MODE,

                                        // pod
                                        {
                                            className: 'pod',
                                            begin: '\\=\\w',
                                            end: '\\=cut'
                                        }
                                    ]
                                }; //perl

                                /*

                                PHP5 definition () Victor Karamzin <Victor.Karamzin@enterra-inc.com>

                                */
                                PHP5_KEYWORDS = {
                                    'and': 1,
                                    'include_once': 1,
                                    'list': 1,
                                    'abstract': 1,
                                    'global': 1,
                                    'private': 1,
                                    'echo': 1,
                                    'interface': 1,
                                    'as': 1,
                                    'static': 1,
                                    'endswitch': 1,
                                    'array': 1,
                                    'null': 1,
                                    'if': 1,
                                    'endwhile': 1,
                                    'or': 1,
                                    'const': 1,
                                    'for': 1,
                                    'endforeach': 1,
                                    'self': 1,
                                    'var': 1,
                                    'while': 1,
                                    'isset': 1,
                                    'public': 1,
                                    'protected': 1,
                                    'exit': 1,
                                    'foreach': 1,
                                    'throw': 1,
                                    'elseif': 1,
                                    'extends': 1,
                                    'include': 1,
                                    '__FILE__': 1,
                                    'empty': 1,
                                    'require_once': 1,
                                    'function': 1,
                                    'do': 1,
                                    'xor': 1,
                                    'return': 1,
                                    'implements': 1,
                                    'parent': 1,
                                    'clone': 1,
                                    'use': 1,
                                    '__CLASS__': 1,
                                    '__LINE__': 1,
                                    'else': 1,
                                    'break': 1,
                                    'print': 1,
                                    'eval': 1,
                                    'new': 1,
                                    'catch': 1,
                                    '__METHOD__': 1,
                                    'class': 1,
                                    'case': 1,
                                    'exception': 1,
                                    'php_user_filter': 1,
                                    'default': 1,
                                    'die': 1,
                                    'require': 1,
                                    '__FUNCTION__': 1,
                                    'enddeclare': 1,
                                    'final': 1,
                                    'try': 1,
                                    'this': 1,
                                    'switch': 1,
                                    'continue': 1,
                                    'endfor': 1,
                                    'endif': 1,
                                    'declare': 1,
                                    'unset': 1
                                };

                                PHP_IDENTIFIER_RE = '[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*';

                                LANGUAGES.php = {
                                    defaultMode: {
                                        lexems: [IDENT_RE],
                                        contains: ['comment', 'number', 'string', 'variable'],
                                        keywords: PHP5_KEYWORDS
                                    },
                                    case_insensitive: true,
                                    modes: [
                                        C_LINE_COMMENT_MODE,
                                        HASH_COMMENT_MODE,
                                        {
                                            className: 'comment',
                                            begin: '/\\*',
                                            end: '\\*/',
                                            contains: ['phpdoc']
                                        },
                                        {
                                            className: 'phpdoc',
                                            begin: '\\s@[A-Za-z]+',
                                            end: '^',
                                            relevance: 10
                                        },
                                        C_NUMBER_MODE,
                                        APOS_STRING_MODE,
                                        QUOTE_STRING_MODE,
                                        {
                                            className: 'variable',
                                            begin: '\\$' + PHP_IDENTIFIER_RE,
                                            end: '^'
                                        },
                                    ]
                                }; //php


                                /*

                                Java definition () Vsevolod Solovyov <vsevolod.solovyov@gmail.com>

                                */
                                LANGUAGES.java = {
                                    defaultMode: {
                                        lexems: [UNDERSCORE_IDENT_RE],
                                        contains: ['comment', 'string', 'class', 'number', 'javadoc', 'annotation'],
                                        keywords: {
                                            'false': 1,
                                            'synchronized': 1,
                                            'int': 1,
                                            'abstract': 1,
                                            'float': 1,
                                            'private': 1,
                                            'char': 1,
                                            'interface': 1,
                                            'boolean': 1,
                                            'static': 1,
                                            'null': 1,
                                            'if': 1,
                                            'const': 1,
                                            'for': 1,
                                            'true': 1,
                                            'while': 1,
                                            'long': 1,
                                            'throw': 1,
                                            'strictfp': 1,
                                            'finally': 1,
                                            'protected': 1,
                                            'extends': 1,
                                            'import': 1,
                                            'native': 1,
                                            'final': 1,
                                            'implements': 1,
                                            'return': 1,
                                            'void': 1,
                                            'enum': 1,
                                            'else': 1,
                                            'break': 1,
                                            'transient': 1,
                                            'new': 1,
                                            'catch': 1,
                                            'instanceof': 1,
                                            'byte': 1,
                                            'super': 1,
                                            'class': 1,
                                            'volatile': 1,
                                            'case': 1,
                                            'assert': 1,
                                            'short': 1,
                                            'package': 1,
                                            'default': 1,
                                            'double': 1,
                                            'public': 1,
                                            'try': 1,
                                            'this': 1,
                                            'switch': 1,
                                            'continue': 1,
                                            'throws': 1
                                        }
                                    },
                                    modes: [{
                                            className: 'class',
                                            lexems: [UNDERSCORE_IDENT_RE],
                                            begin: '(class |interface )',
                                            end: '{',
                                            illegal: ':',
                                            keywords: {
                                                'class': 1,
                                                'interface': 1
                                            },
                                            contains: ['inheritance', 'title']
                                        },
                                        {
                                            className: 'inheritance',
                                            begin: '(implements|extends)',
                                            end: '^',
                                            lexems: [IDENT_RE],
                                            keywords: {
                                                'extends': 1,
                                                'implements': 1
                                            },
                                            relevance: 10
                                        },
                                        {
                                            className: 'title',
                                            begin: UNDERSCORE_IDENT_RE,
                                            end: '^'
                                        },
                                        {
                                            className: 'params',
                                            begin: '\\(',
                                            end: '\\)',
                                            contains: ['string', 'annotation']
                                        },
                                        C_NUMBER_MODE,
                                        APOS_STRING_MODE,
                                        QUOTE_STRING_MODE,
                                        C_LINE_COMMENT_MODE,
                                        {
                                            className: 'javadoc',
                                            begin: '/\\*\\*',
                                            end: '\\*/',
                                            relevance: 10
                                        },
                                        C_BLOCK_COMMENT_MODE,
                                        {
                                            className: 'annotation',
                                            begin: '@[A-Za-z]+',
                                            end: '^'
                                        }
                                    ]
                                }; //java

                                LANGUAGES.cpp = {
                                    defaultMode: {
                                        lexems: [UNDERSCORE_IDENT_RE],
                                        illegal: '</',
                                        contains: ['comment', 'string', 'number', 'preprocessor'],
                                        keywords: {
                                            'false': 1,
                                            'int': 1,
                                            'float': 1,
                                            'while': 1,
                                            'private': 1,
                                            'char': 1,
                                            'catch': 1,
                                            'export': 1,
                                            'virtual': 1,
                                            'operator': 1,
                                            'sizeof': 1,
                                            'dynamic_cast': 1,
                                            'typedef': 1,
                                            'const_cast': 1,
                                            'const': 1,
                                            'struct': 1,
                                            'for': 1,
                                            'static_cast': 1,
                                            'union': 1,
                                            'namespace': 1,
                                            'unsigned': 1,
                                            'long': 1,
                                            'throw': 1,
                                            'volatile': 1,
                                            'static': 1,
                                            'protected': 1,
                                            'bool': 1,
                                            'template': 1,
                                            'mutable': 1,
                                            'if': 1,
                                            'public': 1,
                                            'friend': 1,
                                            'do': 1,
                                            'return': 1,
                                            'goto': 1,
                                            'auto': 1,
                                            'void': 1,
                                            'enum': 1,
                                            'else': 1,
                                            'break': 1,
                                            'new': 1,
                                            'extern': 1,
                                            'using': 1,
                                            'true': 1,
                                            'class': 1,
                                            'asm': 1,
                                            'case': 1,
                                            'typeid': 1,
                                            'short': 1,
                                            'reinterpret_cast': 1,
                                            'default': 1,
                                            'double': 1,
                                            'register': 1,
                                            'explicit': 1,
                                            'signed': 1,
                                            'typename': 1,
                                            'try': 1,
                                            'this': 1,
                                            'switch': 1,
                                            'continue': 1,
                                            'wchar_t': 1,
                                            'inline': 1,
                                            'delete': 1
                                        }
                                    },
                                    modes: [
                                        C_LINE_COMMENT_MODE,
                                        C_BLOCK_COMMENT_MODE,
                                        C_NUMBER_MODE,
                                        QUOTE_STRING_MODE,
                                        {
                                            className: 'string',
                                            begin: '\'',
                                            end: '[^\\\\]\'',
                                            illegal: '[^\\\\][^\']'
                                        },
                                        {
                                            className: 'preprocessor',
                                            begin: '#',
                                            end: '$'
                                        }
                                    ]
                                }; //cpp

                                /*

                                Ruby definition () Anton Kovalyov <anton@kovalyov.net>

                                */
                                LANGUAGES.ruby = {
                                    defaultMode: {
                                        lexems: [UNDERSCORE_IDENT_RE],
                                        contains: ['comment', 'string', 'class', 'function', 'symbol'],
                                        keywords: {
                                            'and': 1,
                                            'false': 1,
                                            'then': 1,
                                            'defined': 1,
                                            'module': 1,
                                            'in': 1,
                                            'return': 1,
                                            'redo': 1,
                                            'if': 1,
                                            'BEGIN': 1,
                                            'retry': 1,
                                            'end': 1,
                                            'for': 1,
                                            'true': 1,
                                            'self': 1,
                                            'when': 1,
                                            'next': 1,
                                            'until': 1,
                                            'do': 1,
                                            'begin': 1,
                                            'unless': 1,
                                            'END': 1,
                                            'rescue': 1,
                                            'nil': 1,
                                            'else': 1,
                                            'break': 1,
                                            'undef': 1,
                                            'not': 1,
                                            'super': 1,
                                            'class': 1,
                                            'case': 1,
                                            'require': 1,
                                            'yield': 1,
                                            'alias': 1,
                                            'while': 1,
                                            'ensure': 1,
                                            'elsif': 1,
                                            'or': 1,
                                            'def': 1
                                        }
                                    },
                                    modes: [
                                        HASH_COMMENT_MODE,
                                        {
                                            className: 'comment',
                                            begin: '^\\=begin',
                                            end: '^\\=end',
                                            relevance: 10
                                        },
                                        APOS_STRING_MODE,
                                        QUOTE_STRING_MODE,
                                        {
                                            className: 'function',
                                            lexems: [IDENT_RE],
                                            begin: 'def ',
                                            end: '$',
                                            illegal: '[{\\:]',
                                            keywords: {
                                                'def': 1
                                            },
                                            contains: ['title', 'comment'],
                                            relevance: 10
                                        },
                                        {
                                            className: 'class',
                                            lexems: [IDENT_RE],
                                            begin: 'class ',
                                            end: '$',
                                            illegal: '[{\\:]',
                                            contains: ['title', 'comment'],
                                            keywords: {
                                                'class': 1
                                            }
                                        },
                                        {
                                            className: 'symbol',
                                            begin: ':' + UNDERSCORE_IDENT_RE,
                                            end: '^'
                                        },
                                        {
                                            className: 'title',
                                            begin: IDENT_RE + "\\s*<\\s*" + IDENT_RE,
                                            end: '^'
                                        },
                                        {
                                            className: 'title',
                                            begin: 'self.' + IDENT_RE,
                                            end: '^'
                                        },
                                        {
                                            className: 'title',
                                            begin: IDENT_RE,
                                            end: '^'
                                        }
                                    ]
                                }; //ruby

                                LANGUAGES.javascript = {
                                    defaultMode: {
                                        lexems: [UNDERSCORE_IDENT_RE],
                                        contains: ['string', 'comment', 'number', 'regexp', 'function', 'literal'],
                                        keywords: {
                                            'in': 1,
                                            'if': 1,
                                            'for': 1,
                                            'while': 1,
                                            'finally': 1,
                                            'var': 1,
                                            'new': 1,
                                            'function': 1,
                                            'do': 1,
                                            'return': 1,
                                            'void': 1,
                                            'else': 1,
                                            'break': 1,
                                            'catch': 1,
                                            'instanceof': 1,
                                            'with': 1,
                                            'throw': 1,
                                            'case': 1,
                                            'default': 1,
                                            'try': 1,
                                            'this': 1,
                                            'switch': 1,
                                            'continue': 1,
                                            'typeof': 1,
                                            'delete': 1
                                        }
                                    },
                                    modes: [
                                        C_LINE_COMMENT_MODE,
                                        C_BLOCK_COMMENT_MODE,
                                        C_NUMBER_MODE,
                                        {
                                            className: 'literal',
                                            begin: '\\b(true|false|null)',
                                            end: '^'
                                        },
                                        APOS_STRING_MODE,
                                        QUOTE_STRING_MODE,
                                        {
                                            className: 'regexp',
                                            begin: '\\/[^\\/]',
                                            end: '(^|[^\\\\])\\/[gim]*'
                                        },
                                        {
                                            className: 'function',
                                            begin: 'function ',
                                            end: '{',
                                            lexems: [UNDERSCORE_IDENT_RE],
                                            keywords: {
                                                'function': 1
                                            },
                                            contains: ['title', 'params']
                                        },
                                        {
                                            className: 'title',
                                            begin: UNDERSCORE_IDENT_RE,
                                            end: '^'
                                        },
                                        {
                                            className: 'params',
                                            begin: '\\(',
                                            end: '\\)',
                                            contains: ['string', 'comment']
                                        }
                                    ]
                                }; //javascript

                                /*

                                VBScript definition (c) Nikita Ledyaev <lenikita@yandex.ru>

                                */
                                VBS_BUILT_IN_FUNCTIONS = 'Abs|Array|Asc|Atn|CBool|CByte|CCur|CDate|CDbl|Chr|CInt|CLng|Conversions|Cos|CreateObject|CSng|Date|DateAdd|DateDiff|DatePart|DateSerial|DateValue|Day|Derived|Maths|Eval|Exp|Filter|FormatCurrency|FormatDateTime|FormatNumber|FormatPercent|GetLocale|GetObject|GetRef|Hex|Hour|InputBox|InStr|InStrRev|Int|Fixs|IsArray|IsDate|IsEmpty|IsNull|sNumeric|IsObject|Join|LBound|LCase|Left|Len|LoadPicture|Log|LTrim|RTrim|Trim|Maths|Mid|Minute|Month|MonthName|MsgBox|Now|Oct|Replace|RGB|Right|Rnd|Round|ScriptEngine|ScriptEngineBuildVersion|ScriptEngineMajorVersion|ScriptEngineMinorVersion|Second|SetLocale|Sgn|Sin|Space|Split|Sqr|StrComp|String|Tan|Time|Timer|TimeSerial|TimeValue|TypeName|UBound|UCase|VarType|Weekday|WeekdayName|Year';

                                LANGUAGES.vbscript = {
                                    defaultMode: {
                                        lexems: [IDENT_RE],
                                        contains: ['string', 'comment', 'number', 'built_in'],
                                        keywords: {
                                            'call': 1,
                                            'class': 1,
                                            'const': 1,
                                            'dim': 1,
                                            'do': 1,
                                            'loop': 1,
                                            'erase': 1,
                                            'execute': 1,
                                            'executeglobal': 1,
                                            'exit': 1,
                                            'for': 1,
                                            'each': 1,
                                            'next': 1,
                                            'function': 1,
                                            'if': 1,
                                            'then': 1,
                                            'else': 1,
                                            'on': 1,
                                            'error': 1,
                                            'option': 1,
                                            'explicit': 1,
                                            'private': 1,
                                            'property': 1,
                                            'let': 1,
                                            'get': 1,
                                            'public': 1,
                                            'randomize': 1,
                                            'redim': 1,
                                            'rem': 1,
                                            'select': 1,
                                            'case': 1,
                                            'set': 1,
                                            'stop': 1,
                                            'sub': 1,
                                            'while': 1,
                                            'wend': 1,
                                            'with': 1,
                                            'end': 1,
                                            'to': 1
                                        }
                                    },
                                    case_insensitive: true,
                                    modes: [
                                        QUOTE_STRING_MODE,
                                        {
                                            className: 'comment',
                                            begin: '\'',
                                            end: '$'
                                        },
                                        C_NUMBER_MODE,
                                        {
                                            className: 'built_in',
                                            begin: '\\b(' + VBS_BUILT_IN_FUNCTIONS + ')',
                                            end: '^'
                                        }
                                    ]
                                }; //vbscript

                                function langRe(language, value, global) {
                                    var mode = 'm' + (language.case_insensitive ? 'i' : '') + (global ? 'g' : '');
                                    return new RegExp(value, mode);
                                } //re

                                for (var i in LANGUAGES) {
                                    var language = LANGUAGES[i];
                                    for (var key in language.modes) {
                                        if (language.modes[key].begin)
                                            language.modes[key].beginRe = langRe(language, '^' + language.modes[key].begin);
                                        if (language.modes[key].end)
                                            language.modes[key].endRe = langRe(language, '^' + language.modes[key].end);
                                        if (language.modes[key].illegal)
                                            language.modes[key].illegalRe = langRe(language, '^(?:' + language.modes[key].illegal + ')');
                                        language.defaultMode.illegalRe = langRe(language, '^(?:' + language.defaultMode.illegal + ')');
                                    } //for
                                } //for

                                var selected_languages = {};

                                function Highlighter(language_name, value) {
                                    currentMode = function() {
                                        return modes[modes.length - 1];
                                    } //currentMode

                                    function subMode(lexem) {
                                        if (!currentMode().contains)
                                            return null;
                                        for (var key in language.modes)
                                            if (contains(currentMode().contains, language.modes[key].className) && language.modes[key].beginRe.test(lexem))
                                                return language.modes[key];
                                        return null;
                                    } //subMode

                                    function endOfMode(mode_index, lexem) {
                                        if (modes[mode_index].end && modes[mode_index].endRe.test(lexem))
                                            return 1;
                                        if (modes[mode_index].endsWithParent) {
                                            var level = endOfMode(mode_index - 1, lexem);
                                            return level ? level + 1 : 0;
                                        } //if
                                        return 0;
                                    } //endOfMode

                                    function isIllegal(lexem) {
                                        if (!currentMode().illegalRe)
                                            return false;
                                        return currentMode().illegalRe.test(lexem);
                                    } //isIllegal

                                    function eatModeChunk(value, index) {
                                        if (!currentMode().terminators) {
                                            var terminators = [];

                                            if (currentMode().contains)
                                                for (var key in language.modes) {
                                                    if (contains(currentMode().contains, language.modes[key].className) &&
                                                        !contains(terminators, language.modes[key].begin))
                                                        terminators[terminators.length] = language.modes[key].begin;
                                                } //for

                                            var mode_index = modes.length - 1;
                                            do {
                                                if (modes[mode_index].end && !contains(terminators, modes[mode_index].end))
                                                    terminators[terminators.length] = modes[mode_index].end;
                                                mode_index--;
                                            } while (modes[mode_index + 1].endsWithParent);

                                            if (currentMode().illegal)
                                                if (!contains(terminators, currentMode().illegal))
                                                    terminators[terminators.length] = currentMode().illegal;

                                            var terminator_re = '(' + terminators[0];
                                            for (var i = 0; i < terminators.length; i++)
                                                terminator_re += '|' + terminators[i];
                                            terminator_re += ')';
                                            currentMode().terminators = langRe(language, terminator_re);
                                        } //if
                                        value = value.substr(index);
                                        var match = currentMode().terminators.exec(value);
                                        if (!match)
                                            return [value, '', true];
                                        if (match.index == 0)
                                            return ['', match[0], false];
                                        else
                                            return [value.substr(0, match.index), match[0], false];
                                    } //eatModeChunk

                                    function escape(value) {
                                        return value.replace(/&/gm, '&amp;').replace(/</gm, '&lt;').replace(/>/gm, '&gt;');
                                    } //escape

                                    function processKeywords(buffer) {
                                        var mode = currentMode();
                                        if (!mode.keywords || !mode.lexems)
                                            return escape(buffer);
                                        if (!mode.lexemsRe) {
                                            var lexems = [];
                                            for (var key in mode.lexems)
                                                if (!contains(lexems, mode.lexems[key]))
                                                    lexems[lexems.length] = mode.lexems[key];
                                            var lexems_re = '(' + lexems[0];
                                            for (var i = 1; i < lexems.length; i++)
                                                lexems_re += '|' + lexems[i];
                                            lexems_re += ')';
                                            mode.lexemsRe = langRe(language, lexems_re, true);
                                        } //if
                                        var result = '';
                                        var last_index = 0;
                                        mode.lexemsRe.lastIndex = 0;
                                        var match = mode.lexemsRe.exec(buffer);
                                        while (match) {
                                            result += escape(buffer.substr(last_index, match.index - last_index));
                                            if (mode.keywords[language.case_insensitive ? match[0].toLowerCase() : match[0]]) {
                                                keyword_count++;
                                                result += '<span class="keyword">' + escape(match[0]) + '</span>';
                                            } else {
                                                result += escape(match[0]);
                                            } //if
                                            last_index = mode.lexemsRe.lastIndex;
                                            match = mode.lexemsRe.exec(buffer);
                                        } //while
                                        result += escape(buffer.substr(last_index, buffer.length - last_index));
                                        return result;
                                    } //processKeywords

                                    function processModeInfo(buffer, lexem, end) {
                                        if (end) {
                                            result += processKeywords(currentMode().buffer + buffer);
                                            return;
                                        } //if
                                        if (isIllegal(lexem))
                                            throw 'Illegal';
                                        var new_mode = subMode(lexem);
                                        if (new_mode) {
                                            currentMode().buffer += buffer;
                                            result += processKeywords(currentMode().buffer);
                                            if (new_mode.excludeBegin) {
                                                result += lexem + '<span class="' + new_mode.className + '">';
                                                new_mode.buffer = '';
                                            } else {
                                                result += '<span class="' + new_mode.className + '">';
                                                new_mode.buffer = lexem;
                                            } //if
                                            modes[modes.length] = new_mode;
                                            relevance += currentMode().relevance != undefined ? currentMode().relevance : 1;
                                            return;
                                        } //if
                                        var end_level = endOfMode(modes.length - 1, lexem);
                                        if (end_level) {
                                            currentMode().buffer += buffer;
                                            if (currentMode().excludeEnd) {
                                                result += processKeywords(currentMode().buffer) + '</span>' + lexem;
                                            } else {
                                                result += processKeywords(currentMode().buffer + lexem) + '</span>';
                                            }
                                            while (end_level > 1) {
                                                result += '</span>';
                                                end_level--;
                                                modes.length--;
                                            } //while
                                            modes.length--;
                                            currentMode().buffer = '';
                                            return;
                                        } //if
                                    } //processModeInfo

                                    function highlight(value) {
                                        var index = 0;
                                        language.defaultMode.buffer = '';
                                        for (var mode_info = eatModeChunk(value, index); index < value.length; mode_info = eatModeChunk(value, index)) {
                                            processModeInfo(mode_info[0], mode_info[1], mode_info[2]);
                                            index += mode_info[0].length + mode_info[1].length;
                                        } //for
                                        if (modes.length > 1)
                                            throw 'Illegal';
                                    } //highlight

                                    this.language_name = language_name;
                                    var language = LANGUAGES[language_name];
                                    var modes = [language.defaultMode];
                                    var relevance = 0;
                                    var keyword_count = 0;
                                    var result = '';
                                    try {
                                        highlight(value);
                                        this.relevance = relevance;
                                        this.keyword_count = keyword_count;
                                        this.result = result;
                                    } catch (e) {
                                        if (e == 'Illegal') {
                                            this.relevance = 0;
                                            this.keyword_count = 0;
                                            this.result = escape(value);
                                        } else {
                                            throw e;
                                        } //if
                                    } //try
                                } //Highlighter

                                function contains(array, item) {
                                    if (!array)
                                        return false;
                                    for (var key in array)
                                        if (array[key] == item)
                                            return true;
                                    return false;
                                } //contains

                                function blockText(block) {
                                    var result = '';
                                    for (var i = 0; i < block.childNodes.length; i++)
                                        if (block.childNodes[i].nodeType == 3)
                                            result += block.childNodes[i].nodeValue;
                                        else if (block.childNodes[i].nodeName == 'BR')
                                        result += '\n';
                                    else
                                        throw 'Complex markup';
                                    return result;
                                } //blockText

                                function initHighlight(block) {
                                    if (block.className.search(/\bno\-highlight\b/) != -1)
                                        return;
                                    try {
                                        blockText(block);
                                    } catch (e) {
                                        if (e == 'Complex markup')
                                            return;
                                    } //try
                                    var classes = block.className.split(/\s+/);
                                    for (var i = 0; i < classes.length; i++) {
                                        if (LANGUAGES[classes[i]]) {
                                            highlightLanguage(block, classes[i]);
                                            return;
                                        } //if
                                    } //for
                                    highlightAuto(block);
                                } //initHighlight

                                function highlightLanguage(block, language) {
                                    var highlight = new Highlighter(language, blockText(block));
                                    // See these 4 lines? This is IE's notion of "block.innerHTML = result". Love this browser :-/
                                    var container = document.createElement('div');
                                    container.innerHTML = '<pre><code class="' + block.className + '">' + highlight.result + '</code></pre>';
                                    var environment = block.parentNode.parentNode;
                                    environment.replaceChild(container.firstChild, block.parentNode);
                                } //highlightLanguage

                                function highlightAuto(block) {
                                    var result = null;
                                    var language = '';
                                    var max_relevance = 2;
                                    var relevance = 0;
                                    var block_text = blockText(block);
                                    for (var key in selected_languages) {
                                        var highlight = new Highlighter(key, block_text);
                                        relevance = highlight.keyword_count + highlight.relevance;
                                        if (highlight.keyword_count && relevance > max_relevance) {
                                            max_relevance = relevance;
                                            result = highlight;
                                        } //if
                                    } //for

                                    if (result) {
                                        // See these 4 lines? This is IE's notion of "block.innerHTML = result". Love this browser :-/
                                        var container = document.createElement('div');
                                        container.innerHTML = '<pre><code class="' + result.language_name + '">' + result.result + '</code></pre>';
                                        var environment = block.parentNode.parentNode;
                                        environment.replaceChild(container.firstChild, block.parentNode);
                                    } //if
                                } //highlightAuto

                                function initHighlighting() {
                                    if (initHighlighting.called)
                                        return;
                                    initHighlighting.called = true;
                                    if (arguments.length) {
                                        for (var i = 0; i < arguments.length; i++) {
                                            if (LANGUAGES[arguments[i]]) {
                                                selected_languages[arguments[i]] = LANGUAGES[arguments[i]];
                                            } //if
                                        } //for
                                    } else
                                        selected_languages = LANGUAGES;
                                    var pres = document.getElementsByTagName('pre');
                                    for (var i = 0; i < pres.length; i++) {
                                        if (pres[i].firstChild && pres[i].firstChild.nodeName == 'CODE')
                                            initHighlight(pres[i].firstChild);
                                    } //for
                                } //initHighlighting

                                function initHighlightingOnLoad() {
                                    var original_arguments = arguments;
                                    var handler = function() {
                                        initHighlighting.apply(null, original_arguments)
                                    };
                                    if (window.addEventListener) {
                                        window.addEventListener('DOMContentLoaded', handler, false);
                                        window.addEventListener('load', handler, false);
                                    } else if (window.attachEvent)
                                        window.attachEvent('onload', handler);
                                    else
                                        window.onload = handler;
                                } //initHighlightingOnLoad
                            </script>
                            <script type="text/javascript">
                                $(function() {
                                    var converter = new Showdown.converter();
                                    $("#user_input").keyup(function() {
                                        var txt = $("#user_input").val();
                                        var html = converter.makeHtml(txt);
                                        $(".wikistyle").html(html)
                                        $("#entry-container, #user_input").css({
                                            height: $(".wikistyle").outerHeight() + 40
                                        })

                                    });
                                });
                            </script>
                            <style>
                                #entry-container {
                                    float: left;
                                    width: 39%;
                                    height: 100%;
                                }

                                #entry-container textarea {
                                    width: 100%;
                                    height: 100%;
                                }

                                body #content.site {
                                    width: auto;
                                    margin: 10px;
                                }

                                body #preview-container {
                                    float: right;
                                    width: 60%;
                                }

                                body {
                                    height: 100%;
                                }

                                .info {
                                    background: black;
                                    color: white;
                                    font-size: 0.8em;
                                    padding: 0.3em;
                                    margin-bottom: 20px;
                                }

                                .info a {
                                    color: yellow;
                                }
                            </style>
                            <div id="content" class="site">
                                <div id="entry-container">
                                    <em>Enter Markdown</em>
                                    <p><textarea id="user_input"></textarea></p>
                                </div>
                                <div id="preview-container">
                                    <em>Live preview</em>
                                    <div id="readme" class="announce md" data-path="/">
                                        <div class="wikistyle content-body markdown-body"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </section>
                
            </div>
        </div>
    </div>

</template>